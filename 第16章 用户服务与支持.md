# ç¬¬16ç«  ç”¨æˆ·æœåŠ¡ä¸æ”¯æŒ

> HPCé›†ç¾¤ç”¨æˆ·æœåŠ¡ä¸æ”¯æŒä½“ç³»æ„å»ºæŒ‡å—

## ğŸ‘¥ æœ¬ç« æ¦‚è¿°

ç”¨æˆ·æœåŠ¡ä¸æ”¯æŒæ˜¯HPCè¿ç»´çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚æœ¬ç« å°†æ·±å…¥ä»‹ç»HPCé›†ç¾¤çš„ç”¨æˆ·åŸ¹è®­ä½“ç³»ã€æŠ€æœ¯æ”¯æŒæµç¨‹ã€ç”¨æˆ·é—®é¢˜è¯Šæ–­æ–¹æ³•å’ŒæœåŠ¡çº§åˆ«ç®¡ç†ï¼Œå¸®åŠ©ä½ å»ºç«‹å®Œå–„çš„ç”¨æˆ·æœåŠ¡ä½“ç³»ï¼Œæå‡ç”¨æˆ·æ»¡æ„åº¦å’Œé›†ç¾¤ä½¿ç”¨æ•ˆç‡ã€‚

**å­¦ä¹ ç›®æ ‡ï¼š**
- æŒæ¡ç”¨æˆ·åŸ¹è®­ä½“ç³»çš„è®¾è®¡å’Œå®æ–½æ–¹æ³•
- å­¦ä¼šå»ºç«‹æ ‡å‡†åŒ–çš„æŠ€æœ¯æ”¯æŒæµç¨‹
- ç†Ÿç»ƒä½¿ç”¨ç”¨æˆ·é—®é¢˜è¯Šæ–­å·¥å…·å’ŒæŠ€å·§
- å»ºç«‹æœ‰æ•ˆçš„æœåŠ¡çº§åˆ«ç®¡ç†æœºåˆ¶

## ğŸ“š ç”¨æˆ·æœåŠ¡ä½“ç³»æ¶æ„

### 16.1 ç”¨æˆ·åŸ¹è®­ä¸æ–‡æ¡£

#### 16.1.1 åŸ¹è®­ä½“ç³»è®¾è®¡

**åˆ†å±‚åŸ¹è®­ä½“ç³»ï¼š**

```bash
#!/bin/bash
# /opt/support/training_system_design.sh

echo "=== HPC User Training System Design ==="

# 1. ç”¨æˆ·åˆ†ç±»å’Œéœ€æ±‚åˆ†æ
echo "1. User Classification and Requirements Analysis..."

# æ–°ç”¨æˆ·åŸ¹è®­ï¼ˆ0-3ä¸ªæœˆï¼‰
cat > /opt/training/new_user_curriculum.md << 'EOF'
# æ–°ç”¨æˆ·åŸ¹è®­è¯¾ç¨‹å¤§çº²

## è¯¾ç¨‹1ï¼šHPCåŸºç¡€æ¦‚å¿µï¼ˆ2å°æ—¶ï¼‰
- ä»€ä¹ˆæ˜¯é«˜æ€§èƒ½è®¡ç®—
- HPCé›†ç¾¤æ¶æ„ä»‹ç»
- å¹¶è¡Œè®¡ç®—åŸºç¡€
- HPCåº”ç”¨åœºæ™¯

## è¯¾ç¨‹2ï¼šLinuxåŸºç¡€æ“ä½œï¼ˆ3å°æ—¶ï¼‰
- Linuxå‘½ä»¤è¡ŒåŸºç¡€
- æ–‡ä»¶ç³»ç»Ÿæ“ä½œ
- æ–‡æœ¬ç¼–è¾‘å™¨ä½¿ç”¨
- æƒé™ç®¡ç†

## è¯¾ç¨‹3ï¼šé›†ç¾¤ä½¿ç”¨å…¥é—¨ï¼ˆ3å°æ—¶ï¼‰
- è´¦å·ç”³è¯·å’Œç™»å½•
- æ–‡ä»¶ä¼ è¾“æ–¹æ³•
- åŸºæœ¬å‘½ä»¤ä½¿ç”¨
- ç¯å¢ƒå˜é‡é…ç½®

## è¯¾ç¨‹4ï¼šä½œä¸šæäº¤ç³»ç»Ÿï¼ˆ4å°æ—¶ï¼‰
- SLURMåŸºç¡€æ¦‚å¿µ
- ä½œä¸šè„šæœ¬ç¼–å†™
- é˜Ÿåˆ—å’Œèµ„æºç”³è¯·
- ä½œä¸šç›‘æ§å’Œç®¡ç†

## è¯¾ç¨‹5ï¼šå®ç”¨å·¥å…·ä»‹ç»ï¼ˆ2å°æ—¶ï¼‰
- ç¼–è¯‘å™¨ä½¿ç”¨
- è°ƒè¯•å·¥å…·
- æ€§èƒ½åˆ†æå·¥å…·
- å¸¸ç”¨è½¯ä»¶ä»‹ç»
EOF

# ä¸­çº§ç”¨æˆ·åŸ¹è®­ï¼ˆ3-12ä¸ªæœˆï¼‰
cat > /opt/training/intermediate_user_curriculum.md << 'EOF'
# ä¸­çº§ç”¨æˆ·åŸ¹è®­è¯¾ç¨‹å¤§çº²

## è¯¾ç¨‹1ï¼šå¹¶è¡Œç¼–ç¨‹åŸºç¡€ï¼ˆ4å°æ—¶ï¼‰
- MPIåŸºç¡€ç¼–ç¨‹
- OpenMPå¤šçº¿ç¨‹
- å¹¶è¡Œç®—æ³•è®¾è®¡
- æ€§èƒ½ä¼˜åŒ–åŸºç¡€

## è¯¾ç¨‹2ï¼šé«˜çº§ä½œä¸šç®¡ç†ï¼ˆ3å°æ—¶ï¼‰
- å¤æ‚ä½œä¸šè„šæœ¬
- é˜µåˆ—ä½œä¸š
- ä¾èµ–ä½œä¸šé“¾
- èµ„æºä¼˜åŒ–

## è¯¾ç¨‹3ï¼šæ€§èƒ½è°ƒä¼˜ï¼ˆ4å°æ—¶ï¼‰
- æ€§èƒ½åˆ†ææ–¹æ³•
- ç“¶é¢ˆè¯†åˆ«
- ä¼˜åŒ–ç­–ç•¥
- åŸºå‡†æµ‹è¯•

## è¯¾ç¨‹4ï¼šè½¯ä»¶ç¯å¢ƒç®¡ç†ï¼ˆ3å°æ—¶ï¼‰
- æ¨¡å—ç³»ç»Ÿä½¿ç”¨
- è½¯ä»¶ç¼–è¯‘å®‰è£…
- å®¹å™¨æŠ€æœ¯
- ç¯å¢ƒé…ç½®

## è¯¾ç¨‹5ï¼šæ•°æ®ç®¡ç†ï¼ˆ2å°æ—¶ï¼‰
- å¹¶è¡Œæ–‡ä»¶ç³»ç»Ÿ
- æ•°æ®å¤‡ä»½ç­–ç•¥
- æ•°æ®ä¼ è¾“ä¼˜åŒ–
- å­˜å‚¨é…é¢ç®¡ç†
EOF

# é«˜çº§ç”¨æˆ·åŸ¹è®­ï¼ˆ12ä¸ªæœˆä»¥ä¸Šï¼‰
cat > /opt/training/advanced_user_curriculum.md << 'EOF'
# é«˜çº§ç”¨æˆ·åŸ¹è®­è¯¾ç¨‹å¤§çº²

## è¯¾ç¨‹1ï¼šé«˜çº§å¹¶è¡Œç¼–ç¨‹ï¼ˆ6å°æ—¶ï¼‰
- MPIé«˜çº§ç‰¹æ€§
- GPUç¼–ç¨‹åŸºç¡€
- æ··åˆç¼–ç¨‹æ¨¡å‹
- å¤§è§„æ¨¡å¹¶è¡Œä¼˜åŒ–

## è¯¾ç¨‹2ï¼šæ€§èƒ½å·¥ç¨‹ï¼ˆ6å°æ—¶ï¼‰
- æ·±åº¦æ€§èƒ½åˆ†æ
- æ¶æ„çº§ä¼˜åŒ–
- ç¼–è¯‘å™¨ä¼˜åŒ–
- æ•°å­¦åº“ä¼˜åŒ–

## è¯¾ç¨‹3ï¼šå¤§è§„æ¨¡è®¡ç®—ï¼ˆ4å°æ—¶ï¼‰
- è¶…å¤§è§„æ¨¡ä½œä¸š
- å†…å­˜ç®¡ç†ä¼˜åŒ–
- I/Oæ€§èƒ½ä¼˜åŒ–
- ç½‘ç»œé€šä¿¡ä¼˜åŒ–

## è¯¾ç¨‹4ï¼šä¸“ä¸šé¢†åŸŸåº”ç”¨ï¼ˆ4å°æ—¶ï¼‰
- CFDè®¡ç®—ä¼˜åŒ–
- åˆ†å­åŠ¨åŠ›å­¦æ¨¡æ‹Ÿ
- æœºå™¨å­¦ä¹ ä¼˜åŒ–
- å¤§æ•°æ®åˆ†æ

## è¯¾ç¨‹5ï¼šé›†ç¾¤ç®¡ç†åŸºç¡€ï¼ˆ3å°æ—¶ï¼‰
- ç³»ç»Ÿç›‘æ§
- æ•…éšœè¯Šæ–­
- å®‰å…¨ç®¡ç†
- æœ€ä½³å®è·µ
EOF

# 2. åŸ¹è®­èµ„æºå‡†å¤‡
echo "2. Training Resource Preparation..."

# åˆ›å»ºåŸ¹è®­ææ–™ç›®å½•ç»“æ„
mkdir -p /opt/training/materials/{slides,hands_on,reference,certification}

# åŸ¹è®­PPTæ¨¡æ¿
cat > /opt/training/templates/presentation_template.md << 'EOF'
# HPCåŸ¹è®­PPTæ¨¡æ¿ç»“æ„

## å°é¢é¡µ
- è¯¾ç¨‹æ ‡é¢˜
- åŸ¹è®­å¸ˆä¿¡æ¯
- æ—¥æœŸå’Œåœ°ç‚¹

## è¯¾ç¨‹ç›®æ ‡
- å­¦ä¹ ç›®æ ‡
- é¢„æœŸæ”¶è·
- é€‚ç”¨äººç¾¤

## ç†è®ºè®²è§£
- æ¦‚å¿µä»‹ç»
- åŸç†è¯´æ˜
- æŠ€æœ¯ç»†èŠ‚

## å®æ“æ¼”ç¤º
- æ­¥éª¤æ¼”ç¤º
- ä»£ç ç¤ºä¾‹
- å¸¸è§é—®é¢˜

## ç»ƒä¹ ç¯èŠ‚
- ç»ƒä¹ é¢˜ç›®
- æŒ‡å¯¼è¦ç‚¹
- ç­”æ¡ˆè§£æ

## æ€»ç»“å›é¡¾
- é‡ç‚¹å›é¡¾
- å…³é”®è¦ç‚¹
- åç»­å­¦ä¹ 

## Q&Aç¯èŠ‚
- é—®é¢˜æ”¶é›†
- ç­”ç–‘è§£æƒ‘
- åé¦ˆæ”¶é›†
EOF

# 3. åŸ¹è®­å®æ–½è®¡åˆ’
echo "3. Training Implementation Plan..."

# å¹´åº¦åŸ¹è®­è®¡åˆ’
cat > /opt/training/annual_plan.md << 'EOF'
# å¹´åº¦åŸ¹è®­è®¡åˆ’

## ç¬¬ä¸€å­£åº¦
- 1æœˆï¼šæ–°ç”¨æˆ·åŸ¹è®­ï¼ˆåŸºç¡€ç­ï¼‰
- 2æœˆï¼šä¸­çº§ç”¨æˆ·åŸ¹è®­ï¼ˆå¹¶è¡Œç¼–ç¨‹ï¼‰
- 3æœˆï¼šé«˜çº§ç”¨æˆ·åŸ¹è®­ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰

## ç¬¬äºŒå­£åº¦
- 4æœˆï¼šæ–°ç”¨æˆ·åŸ¹è®­ï¼ˆåŸºç¡€ç­ï¼‰
- 5æœˆï¼šä¸­çº§ç”¨æˆ·åŸ¹è®­ï¼ˆä½œä¸šç®¡ç†ï¼‰
- 6æœˆï¼šé«˜çº§ç”¨æˆ·åŸ¹è®­ï¼ˆå¤§è§„æ¨¡è®¡ç®—ï¼‰

## ç¬¬ä¸‰å­£åº¦
- 7æœˆï¼šæ–°ç”¨æˆ·åŸ¹è®­ï¼ˆåŸºç¡€ç­ï¼‰
- 8æœˆï¼šä¸­çº§ç”¨æˆ·åŸ¹è®­ï¼ˆæ€§èƒ½è°ƒä¼˜ï¼‰
- 9æœˆï¼šé«˜çº§ç”¨æˆ·åŸ¹è®­ï¼ˆä¸“ä¸šé¢†åŸŸï¼‰

## ç¬¬å››å­£åº¦
- 10æœˆï¼šæ–°ç”¨æˆ·åŸ¹è®­ï¼ˆåŸºç¡€ç­ï¼‰
- 11æœˆï¼šä¸­çº§ç”¨æˆ·åŸ¹è®­ï¼ˆè½¯ä»¶ç¯å¢ƒï¼‰
- 12æœˆï¼šé«˜çº§ç”¨æˆ·åŸ¹è®­ï¼ˆé›†ç¾¤ç®¡ç†ï¼‰

## ç‰¹è‰²åŸ¹è®­
- æ˜¥å­£ï¼šHPCæŠ€æœ¯å¤§ä¼š
- å¤å­£ï¼šæš‘æœŸå­¦æ ¡
- ç§‹å­£ï¼šç”¨æˆ·äº¤æµä¼š
- å†¬å­£ï¼šå¹´åº¦æ€»ç»“ä¼š
EOF

echo "=== Training System Design Complete ==="
```

#### 16.1.2 åŸ¹è®­ææ–™å¼€å‘

**åŸ¹è®­è§†é¢‘åˆ¶ä½œè„šæœ¬ï¼š**

```bash
#!/bin/bash
# /opt/support/video_production.sh

echo "=== HPC Training Video Production ==="

# 1. è§†é¢‘å½•åˆ¶å‡†å¤‡
echo "1. Video Recording Preparation..."

# å½•åˆ¶ç¯å¢ƒé…ç½®
cat > /opt/training/scripts/recording_setup.sh << 'EOF'
#!/bin/bash
# å½•åˆ¶ç¯å¢ƒè®¾ç½®è„šæœ¬

# è®¾ç½®å±å¹•åˆ†è¾¨ç‡
xrandr --output HDMI-1 --mode 1920x1080

# æ¸…ç†æ¡Œé¢ç¯å¢ƒ
rm -rf ~/Desktop/*
mkdir -p ~/Desktop/HPC_Training

# å‡†å¤‡æ¼”ç¤ºæ–‡ä»¶
cp /opt/training/examples/* ~/Desktop/HPC_Training/

# è®¾ç½®ç»ˆç«¯å­—ä½“å’Œé¢œè‰²
echo "Setting up terminal for recording..."
gsettings set org.gnome.Terminal.Legacy.Profile:/org/gnome/terminal/legacy/profiles:/:$(gsettings get org.gnome.Terminal.ProfilesList default | tr -d \')/ font 'Monospace 14'
gsettings set org.gnome.Terminal.Legacy.Profile:/org/gnome/terminal/legacy/profiles:/:$(gsettings get org.gnome.Terminal.ProfilesList default | tr -d \')/ palette "['rgb(0,0,0)','rgb(173,6,6)','rgb(11,102,11)','rgb(187,150,0)','rgb(28,28,216)','rgb(152,0,152)','rgb(17,168,182)','rgb(203,204,205)','rgb(102,102,102)','rgb(247,37,37)','rgb(55,238,55)','rgb(255,255,51)','rgb(59,59,240)','rgb(238,55,238)','rgb(26,240,238)','rgb(240,240,240)']"

# å¯åŠ¨å½•å±è½¯ä»¶
echo "Starting screen recording..."
recordmydesktop --windowid=$(xwininfo -root | grep "id:" | awk '{print $4}') --no-sound --output ~/Desktop/HPC_Training/recording.ogv &
RECORD_PID=$!
EOF

# 2. æ¼”ç¤ºè„šæœ¬å‡†å¤‡
echo "2. Demo Script Preparation..."

# åŸºç¡€æ“ä½œæ¼”ç¤ºè„šæœ¬
cat > /opt/training/demos/basic_operations.sh << 'EOF'
#!/bin/bash
# åŸºç¡€æ“ä½œæ¼”ç¤ºè„šæœ¬

echo "=== HPCåŸºç¡€æ“ä½œæ¼”ç¤º ==="

# 1. ç™»å½•æ¼”ç¤º
echo "1. ç™»å½•é›†ç¾¤"
echo "ssh username@cluster.example.com"
echo "è¾“å…¥å¯†ç : ********"

# 2. åŸºæœ¬å‘½ä»¤æ¼”ç¤º
echo ""
echo "2. åŸºæœ¬Linuxå‘½ä»¤"
echo "æ˜¾ç¤ºå½“å‰ç›®å½•: pwd"
pwd

echo ""
echo "æ˜¾ç¤ºæ–‡ä»¶åˆ—è¡¨: ls -la"
ls -la

echo ""
echo "åˆ›å»ºç›®å½•: mkdir my_project"
mkdir -p ~/my_project
ls -la

echo ""
echo "æŸ¥çœ‹æ–‡ä»¶å†…å®¹: cat /etc/hostname"
cat /etc/hostname

# 3. æ–‡ä»¶ä¼ è¾“æ¼”ç¤º
echo ""
echo "3. æ–‡ä»¶ä¼ è¾“"
echo "ä¸Šä¼ æ–‡ä»¶: scp local_file.txt user@cluster:/home/user/"
echo "ä¸‹è½½æ–‡ä»¶: scp user@cluster:/home/user/remote_file.txt ."

# 4. ä½œä¸šæäº¤æ¼”ç¤º
echo ""
echo "4. ä½œä¸šæäº¤æ¼”ç¤º"
echo "ç¼–å†™ä½œä¸šè„šæœ¬: nano job_script.sh"
cat > job_script.sh << 'EOF'
#!/bin/bash
#SBATCH --job-name=test_job
#SBATCH --output=output.txt
#SBATCH --time=01:00:00
#SBATCH --nodes=1
#SBATCH --ntasks-per-node=4

echo "å¼€å§‹æ‰§è¡Œä½œä¸š"
echo "å½“å‰æ—¶é—´: $(date)"
echo "èŠ‚ç‚¹ä¿¡æ¯: $(hostname)"
echo "ç»“æŸæ‰§è¡Œä½œä¸š"
EOF

echo "æäº¤ä½œä¸š: sbatch job_script.sh"
sbatch job_script.sh

echo ""
echo "æŸ¥çœ‹ä½œä¸šçŠ¶æ€: squeue"
squeue

# 5. ç»“æœæŸ¥çœ‹æ¼”ç¤º
echo ""
echo "5. ç»“æœæŸ¥çœ‹"
echo "æŸ¥çœ‹è¾“å‡ºæ–‡ä»¶: cat slurm-*.out"
echo "æŸ¥çœ‹ä½œä¸šä¿¡æ¯: scontrol show job JOB_ID"
EOF

# å¹¶è¡Œç¼–ç¨‹æ¼”ç¤ºè„šæœ¬
cat > /opt/training/demos/parallel_programming.sh << 'EOF'
#!/bin/bash
# å¹¶è¡Œç¼–ç¨‹æ¼”ç¤ºè„šæœ¬

echo "=== å¹¶è¡Œç¼–ç¨‹æ¼”ç¤º ==="

# 1. MPIç¨‹åºæ¼”ç¤º
echo "1. MPIç¨‹åºç¼–è¯‘å’Œè¿è¡Œ"
cat > hello_mpi.c << 'EOF'
#include <mpi.h>
#include <stdio.h>

int main(int argc, char *argv[]) {
    int rank, size;

    MPI_Init(&argc, &argv);
    MPI_Comm_rank(MPI_COMM_WORLD, &rank);
    MPI_Comm_size(MPI_COMM_WORLD, &size);

    printf("Hello from process %d of %d\n", rank, size);

    MPI_Finalize();
    return 0;
}
EOF

echo "ç¼–è¯‘MPIç¨‹åº: mpicc hello_mpi.c -o hello_mpi"
mpicc hello_mpi.c -o hello_mpi

echo "è¿è¡ŒMPIç¨‹åº: mpirun -np 4 ./hello_mpi"
mpirun -np 4 ./hello_mpi

# 2. OpenMPç¨‹åºæ¼”ç¤º
echo ""
echo "2. OpenMPç¨‹åºç¼–è¯‘å’Œè¿è¡Œ"
cat > hello_omp.c << 'EOF'
#include <omp.h>
#include <stdio.h>

int main() {
    #pragma omp parallel
    {
        int thread_id = omp_get_thread_num();
        int num_threads = omp_get_num_threads();
        printf("Hello from thread %d of %d\n", thread_id, num_threads);
    }
    return 0;
}
EOF

echo "ç¼–è¯‘OpenMPç¨‹åº: gcc -fopenmp hello_omp.c -o hello_omp"
gcc -fopenmp hello_omp.c -o hello_omp

echo "è¿è¡ŒOpenMPç¨‹åº: ./hello_omp"
export OMP_NUM_THREADS=4
./hello_omp

# 3. æ··åˆç¼–ç¨‹æ¼”ç¤º
echo ""
echo "3. æ··åˆç¼–ç¨‹æ¼”ç¤º"
cat > hybrid_example.c << 'EOF'
#include <mpi.h>
#include <omp.h>
#include <stdio.h>

int main(int argc, char *argv[]) {
    int rank, size;

    MPI_Init(&argc, &argv);
    MPI_Comm_rank(MPI_COMM_WORLD, &rank);
    MPI_Comm_size(MPI_COMM_WORLD, &size);

    #pragma omp parallel
    {
        int thread_id = omp_get_thread_num();
        int num_threads = omp_get_num_threads();
        printf("Process %d, Thread %d of %d\n", rank, thread_id, num_threads);
    }

    MPI_Finalize();
    return 0;
}
EOF

echo "ç¼–è¯‘æ··åˆç¨‹åº: mpicc -fopenmp hybrid_example.c -o hybrid_example"
mpicc -fopenmp hybrid_example.c -o hybrid_example

echo "è¿è¡Œæ··åˆç¨‹åº: mpirun -np 2 ./hybrid_example"
mpirun -np 2 ./hybrid_example
EOF

# 3. è§†é¢‘ç¼–è¾‘è„šæœ¬
echo "3. Video Editing Script..."

cat > /opt/training/scripts/video_edit.sh << 'EOF'
#!/bin/bash
# è§†é¢‘ç¼–è¾‘è„šæœ¬

INPUT_VIDEO=$1
OUTPUT_VIDEO=$2

if [ -z "$INPUT_VIDEO" ] || [ -z "$OUTPUT_VIDEO" ]; then
    echo "Usage: $0 <input_video> <output_video>"
    exit 1
fi

# è§†é¢‘å‰ªè¾‘å’Œä¼˜åŒ–
ffmpeg -i "$INPUT_VIDEO" \
    -vf "scale=1280:720,fps=30" \
    -c:v libx264 \
    -preset slow \
    -crf 22 \
    -c:a aac \
    -b:a 128k \
    "$OUTPUT_VIDEO"

# ç”Ÿæˆç¼©ç•¥å›¾
ffmpeg -i "$OUTPUT_VIDEO" -ss 00:00:05 -vframes 1 -vf "scale=320:180" "${OUTPUT_VIDEO%.*}_thumb.jpg"

echo "Video processing complete: $OUTPUT_VIDEO"
EOF

# 4. å­—å¹•ç”Ÿæˆè„šæœ¬
echo "4. Subtitle Generation..."

cat > /opt/training/scripts/generate_subtitles.sh << 'EOF'
#!/bin/bash
# è‡ªåŠ¨ç”Ÿæˆå­—å¹•è„šæœ¬

VIDEO_FILE=$1

if [ -z "$VIDEO_FILE" ]; then
    echo "Usage: $0 <video_file>"
    exit 1
fi

# ä½¿ç”¨è¯­éŸ³è¯†åˆ«ç”Ÿæˆå­—å¹•
echo "Generating subtitles for: $VIDEO_FILE"

# è¿™é‡Œå¯ä»¥é›†æˆè¯­éŸ³è¯†åˆ«API
# ä¾‹å¦‚ï¼šGoogle Speech-to-Text, Azure Speech Serviceç­‰

echo "Subtitle generation would be implemented here"
echo "This would require integration with speech recognition services"

# ç”Ÿæˆå­—å¹•æ–‡ä»¶æ¨¡æ¿
cat > "${VIDEO_FILE%.*}.srt" << 'EOF'
1
00:00:01,000 --> 00:00:05,000
æ¬¢è¿å­¦ä¹ HPCé›†ç¾¤ä½¿ç”¨è¯¾ç¨‹

2
00:00:06,000 --> 00:00:10,000
æœ¬è¯¾ç¨‹å°†ä»‹ç»é«˜æ€§èƒ½è®¡ç®—çš„åŸºç¡€çŸ¥è¯†
EOF

echo "Subtitle file created: ${VIDEO_FILE%.*}.srt"
EOF

echo "=== Video Production Setup Complete ==="
```

#### 16.1.3 åœ¨çº¿å­¦ä¹ å¹³å°

**å­¦ä¹ ç®¡ç†ç³»ç»Ÿï¼ˆLMSï¼‰é…ç½®ï¼š**

```bash
#!/bin/bash
# /opt/support/lms_setup.sh

echo "=== Learning Management System Setup ==="

# 1. å®‰è£…Moodleï¼ˆå¼€æºLMSï¼‰
echo "1. Installing Moodle..."

# å®‰è£…LAMPç¯å¢ƒ
yum install -y httpd mariadb-server php php-mysql php-gd php-xml php-mbstring php-intl

# å¯åŠ¨æœåŠ¡
systemctl enable httpd mariadb
systemctl start httpd mariadb

# é…ç½®æ•°æ®åº“
mysql -u root << 'MYSQL_EOF'
CREATE DATABASE moodle DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'moodleuser'@'localhost' IDENTIFIED BY 'securepassword';
GRANT ALL PRIVILEGES ON moodle.* TO 'moodleuser'@'localhost';
FLUSH PRIVILEGES;
MYSQL_EOF

# ä¸‹è½½å’Œå®‰è£…Moodle
cd /var/www/html
wget https://download.moodle.org/download.php/latest/moodle-latest.tgz
tar -xzf moodle-latest.tgz
chown -R apache:apache moodle
chmod -R 755 moodle

# 2. é…ç½®è¯¾ç¨‹ç»“æ„
echo "2. Configuring Course Structure..."

# åˆ›å»ºè¯¾ç¨‹ç›®å½•
mkdir -p /var/www/html/moodledata
chown -R apache:apache /var/www/html/moodledata

# 3. é…ç½®HPCä¸“ç”¨è¯¾ç¨‹
echo "3. Setting up HPC-specific courses..."

# åˆ›å»ºè¯¾ç¨‹é…ç½®æ–‡ä»¶
cat > /opt/training/lms/courses_config.json << 'EOF'
{
  "courses": [
    {
      "id": "hpc-basics",
      "name": "HPCåŸºç¡€å…¥é—¨",
      "description": "ä»‹ç»é«˜æ€§èƒ½è®¡ç®—çš„åŸºæœ¬æ¦‚å¿µå’Œé›†ç¾¤ä½¿ç”¨æ–¹æ³•",
      "modules": [
        {
          "name": "HPCæ¦‚è¿°",
          "content": [
            "ä»€ä¹ˆæ˜¯é«˜æ€§èƒ½è®¡ç®—",
            "HPCåº”ç”¨åœºæ™¯",
            "é›†ç¾¤æ¶æ„ä»‹ç»"
          ],
          "resources": [
            "hpc_overview.pdf",
            "cluster_architecture.pptx"
          ]
        },
        {
          "name": "LinuxåŸºç¡€",
          "content": [
            "å‘½ä»¤è¡Œæ“ä½œ",
            "æ–‡ä»¶ç³»ç»Ÿç®¡ç†",
            "æƒé™æ§åˆ¶"
          ],
          "resources": [
            "linux_basics.pdf",
            "command_reference.pdf"
          ]
        }
      ]
    },
    {
      "id": "slurm-basics",
      "name": "SLURMä½œä¸šç®¡ç†",
      "description": "å­¦ä¹ SLURMä½œä¸šè°ƒåº¦ç³»ç»Ÿçš„ä½¿ç”¨æ–¹æ³•",
      "modules": [
        {
          "name": "SLURMåŸºç¡€",
          "content": [
            "SLURMæ¦‚å¿µ",
            "ä½œä¸šæäº¤",
            "èµ„æºç®¡ç†"
          ]
        }
      ]
    }
  ]
}
EOF

# 4. é›†æˆè§†é¢‘èµ„æº
echo "4. Integrating video resources..."

# åˆ›å»ºè§†é¢‘èµ„æºç›®å½•
mkdir -p /var/www/html/videos
mkdir -p /var/www/html/videos/{beginner,intermediate,advanced}

# 5. é…ç½®åœ¨çº¿æµ‹è¯•
echo "5. Setting up online assessments..."

# åˆ›å»ºæµ‹è¯•é…ç½®
cat > /opt/training/lms/assessments.json << 'EOF'
{
  "assessments": [
    {
      "id": "hpc-basics-quiz",
      "name": "HPCåŸºç¡€æµ‹è¯•",
      "questions": [
        {
          "type": "multiple_choice",
          "question": "ä»€ä¹ˆæ˜¯HPCï¼Ÿ",
          "options": [
            "High Performance Computing",
            "High Power Computing",
            "High Precision Computing",
            "High Parallel Computing"
          ],
          "correct_answer": 0
        }
      ]
    }
  ]
}
EOF

# 6. é…ç½®ç”¨æˆ·è®¤è¯
echo "6. Configuring user authentication..."

# é›†æˆLDAPè®¤è¯ï¼ˆå¦‚æœéœ€è¦ï¼‰
cat > /opt/training/lms/ldap_config.php << 'EOF'
<?php
// LDAP Configuration for HPC Training System

$CFG->auth_ldap_host_url = 'ldap://ldap.example.com';
$CFG->auth_ldap_bind_dn = 'cn=admin,dc=example,dc=com';
$CFG->auth_ldap_bind_pw = 'admin_password';
$CFG->auth_ldap_base_dn = 'ou=users,dc=example,dc=com';
$CFG->auth_ldap_user_type = 'rfc2307';
$CFG->auth_ldap_objectclass = 'inetOrgPerson';

// Enable LDAP authentication
$CFG->auth = 'ldap';
?>
EOF

echo "=== LMS Setup Complete ==="
echo "Moodle installation completed"
echo "Access the LMS at: http://your-server/moodle"
echo "Default admin credentials: admin/admin"
```

#### 16.1.4 æ–‡æ¡£ç®¡ç†ç³»ç»Ÿ

**æŠ€æœ¯æ–‡æ¡£ç¼–å†™å’Œç®¡ç†ï¼š**

```bash
#!/bin/bash
# /opt/support/documentation_system.sh

echo "=== Documentation Management System ==="

# 1. å»ºç«‹æ–‡æ¡£ç»“æ„
echo "1. Creating documentation structure..."

mkdir -p /opt/docs/{user_guides,admin_guides,api_docs,faq,troubleshooting}

# ç”¨æˆ·æŒ‡å—
cat > /opt/docs/user_guides/quick_start.md << 'EOF'
# HPCé›†ç¾¤å¿«é€Ÿå…¥é—¨æŒ‡å—

## 1. è´¦å·ç”³è¯·
è®¿é—® [è´¦å·ç”³è¯·é¡µé¢](https://cluster.example.com/accountç”³è¯·)

æ‰€éœ€ææ–™ï¼š
- èº«ä»½è¯å¤å°ä»¶
- å¯¼å¸ˆæ¨èä¿¡
- ç ”ç©¶è®¡åˆ’è¯´æ˜

## 2. é›†ç¾¤ç™»å½•
```bash
ssh username@cluster.example.com
```

## 3. åŸºæœ¬æ“ä½œ
```bash
# æŸ¥çœ‹å½“å‰ç›®å½•
pwd

# åˆ—å‡ºæ–‡ä»¶
ls -la

# åˆ›å»ºç›®å½•
mkdir my_project

# ç¼–è¾‘æ–‡ä»¶
nano myfile.txt
```

## 4. ä½œä¸šæäº¤
```bash
# ç¼–å†™ä½œä¸šè„šæœ¬
cat > job.sh << 'EOF'
#!/bin/bash
#SBATCH --job-name=test
#SBATCH --output=result.txt
#SBATCH --time=01:00:00
#SBATCH --nodes=1
#SBATCH --ntasks-per-node=4

echo "Hello HPC!"
EOF

# æäº¤ä½œä¸š
sbatch job.sh

# æŸ¥çœ‹ä½œä¸šçŠ¶æ€
squeue
```

## 5. è·å–å¸®åŠ©
- åœ¨çº¿æ–‡æ¡£ï¼šhttps://docs.cluster.example.com
- æŠ€æœ¯æ”¯æŒï¼šsupport@cluster.example.com
- ç”µè¯æ”¯æŒï¼š400-xxx-xxxx
EOF

# ç®¡ç†å‘˜æŒ‡å—
cat > /opt/docs/admin_guides/cluster_management.md << 'EOF'
# HPCé›†ç¾¤ç®¡ç†æŒ‡å—

## 1. èŠ‚ç‚¹ç®¡ç†
```bash
# æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€
scontrol show nodes

# è®¾ç½®èŠ‚ç‚¹çŠ¶æ€
scontrol update NodeName=node01 State=DOWN Reason="Maintenance"

# é‡æ–°å¯ç”¨èŠ‚ç‚¹
scontrol update NodeName=node01 State=RESUME
```

## 2. ç”¨æˆ·ç®¡ç†
```bash
# æ·»åŠ ç”¨æˆ·
useradd -m newuser
echo "password" | passwd --stdin newuser

# è®¾ç½®ç”¨æˆ·ç»„
usermod -a -G hpc_users newuser

# è®¾ç½®é…é¢
setquota -u newuser 0 1048576 0 100000 /home
```

## 3. è½¯ä»¶ç®¡ç†
```bash
# å®‰è£…è½¯ä»¶æ¨¡å—
module use /opt/modules
module load software/1.0

# åˆ›å»ºæ¨¡å—æ–‡ä»¶
cat > /opt/modules/software/1.0 << 'EOF'
#%Module1.0
prepend-path PATH /opt/software/1.0/bin
prepend-path LD_LIBRARY_PATH /opt/software/1.0/lib
setenv SOFTWARE_HOME /opt/software/1.0
EOF
```

## 4. ç›‘æ§å’Œç»´æŠ¤
```bash
# ç³»ç»Ÿç›‘æ§
htop
iostat 1
netstat -tuln

# æ—¥å¿—åˆ†æ
tail -f /var/log/messages
grep -i error /var/log/slurm/*.log
```
EOF

# 2. é…ç½®æ–‡æ¡£è‡ªåŠ¨åŒ–
echo "2. Setting up documentation automation..."

# ä½¿ç”¨Sphinxç”Ÿæˆæ–‡æ¡£
cat > /opt/docs/Makefile << 'EOF'
# Sphinx Makefile for HPC Documentation

SPHINXBUILD      = sphinx-build
SPHINXAPIDOC     = sphinx-apidoc
SPHINXOPTS       = -W
SPHINXPROJECT    = hpc-docs
SOURCEDIR        = source
BUILDDIR         = build

.PHONY: help Makefile

help:
	@$(SPHINXBUILD) -M help "$(SOURCEDIR)" "$(BUILDDIR)" $(SPHINXOPTS) $(O)

# Build documentation
html:
	@$(SPHINXBUILD) -M html "$(SOURCEDIR)" "$(BUILDDIR)" $(SPHINXOPTS) $(O)

# Clean build directory
clean:
	rm -rf $(BUILDDIR)/*

# Auto-generate API documentation
apidoc:
	$(SPHINXAPIDOC) -o $(SOURCEDIR)/api /opt/hpc-code

# Build all formats
all: html apidoc
EOF

# Sphinxé…ç½®æ–‡ä»¶
cat > /opt/docs/source/conf.py << 'EOF'
# Configuration file for the Sphinx documentation builder.

project = 'HPC Cluster Documentation'
copyright = '2024, HPC Support Team'
author = 'HPC Support Team'

# Extensions
extensions = [
    'sphinx.ext.autodoc',
    'sphinx.ext.viewcode',
    'sphinx.ext.napoleon',
    'sphinx.ext.intersphinx',
]

# HTML theme
html_theme = 'sphinx_rtd_theme'
html_static_path = ['_static']

# Napoleon settings
napoleon_google_docstring = True
napoleon_numpy_docstring = True
napoleon_include_init_with_doc = False

# Intersphinx mapping
intersphinx_mapping = {
    'python': ('https://docs.python.org/3', None),
    'numpy': ('https://numpy.org/doc/stable/', None),
}
EOF

# 3. åˆ›å»ºæ–‡æ¡£æ¨¡æ¿
echo "3. Creating documentation templates..."

# ç”¨æˆ·æŒ‡å—æ¨¡æ¿
cat > /opt/docs/templates/user_guide_template.md << 'EOF'
# [æœåŠ¡åç§°] ç”¨æˆ·æŒ‡å—

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [å‡†å¤‡å·¥ä½œ](#å‡†å¤‡å·¥ä½œ)
3. [åŸºæœ¬ä½¿ç”¨](#åŸºæœ¬ä½¿ç”¨)
4. [é«˜çº§åŠŸèƒ½](#é«˜çº§åŠŸèƒ½)
5. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
6. [æŠ€æœ¯æ”¯æŒ](#æŠ€æœ¯æ”¯æŒ)

## ç®€ä»‹
ç®€è¦ä»‹ç»æœåŠ¡çš„åŠŸèƒ½å’Œç‰¹ç‚¹ã€‚

## å‡†å¤‡å·¥ä½œ
### ç¯å¢ƒè¦æ±‚
- æ“ä½œç³»ç»Ÿè¦æ±‚
- è½¯ä»¶ä¾èµ–
- ç½‘ç»œè¦æ±‚

### è´¦å·ç”³è¯·
ç”³è¯·æµç¨‹å’Œæ‰€éœ€ææ–™ã€‚

## åŸºæœ¬ä½¿ç”¨
### ç™»å½•æ–¹æ³•
```bash
ssh username@server.example.com
```

### åŸºæœ¬å‘½ä»¤
åˆ—å‡ºå¸¸ç”¨å‘½ä»¤åŠå…¶è¯´æ˜ã€‚

## é«˜çº§åŠŸèƒ½
### åŠŸèƒ½1
è¯¦ç»†è¯´æ˜å’Œç¤ºä¾‹ã€‚

### åŠŸèƒ½2
è¯¦ç»†è¯´æ˜å’Œç¤ºä¾‹ã€‚

## å¸¸è§é—®é¢˜
### Q: é—®é¢˜æè¿°
A: è§£å†³æ–¹æ¡ˆ

## æŠ€æœ¯æ”¯æŒ
- è”ç³»æ–¹å¼
- æ”¯æŒæ—¶é—´
- å“åº”æ—¶é—´
EOF

# APIæ–‡æ¡£æ¨¡æ¿
cat > /opt/docs/templates/api_template.md << 'EOF'
# [APIåç§°] æ¥å£æ–‡æ¡£

## æ¥å£æ¦‚è¿°
ç®€è¦æè¿°APIçš„åŠŸèƒ½å’Œç”¨é€”ã€‚

## è®¤è¯æ–¹å¼
è¯´æ˜APIçš„è®¤è¯æœºåˆ¶ã€‚

## åŸºç¡€URL
```
https://api.example.com/v1
```

## æ¥å£åˆ—è¡¨
### 1. æ¥å£åç§°
**è¯·æ±‚æ–¹å¼**: GET/POST/PUT/DELETE

**è¯·æ±‚URL**: `/api/endpoint`

**è¯·æ±‚å‚æ•°**:
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| param1 | string | æ˜¯ | å‚æ•°è¯´æ˜ |

**å“åº”æ ¼å¼**:
```json
{
    "status": "success",
    "data": {
        "key": "value"
    }
}
```

**é”™è¯¯ç **:
| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 401 | è®¤è¯å¤±è´¥ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

## ç¤ºä¾‹ä»£ç 
### Python
```python
import requests

response = requests.get('https://api.example.com/v1/endpoint')
print(response.json())
```

### Bash
```bash
curl -X GET "https://api.example.com/v1/endpoint" \
     -H "Authorization: Bearer your_token"
```
EOF

# 4. é…ç½®æ–‡æ¡£ç‰ˆæœ¬æ§åˆ¶
echo "4. Setting up documentation version control..."

# Gitä»“åº“åˆå§‹åŒ–
cd /opt/docs
git init
git add .
git commit -m "Initial documentation commit"

# åˆ›å»ºç‰ˆæœ¬æ ‡ç­¾
git tag -a v1.0 -m "Initial documentation release"

# 5. é…ç½®åœ¨çº¿æ–‡æ¡£
echo "5. Setting up online documentation..."

# ä½¿ç”¨GitHub Pagesæˆ–GitLab Pages
cat > /opt/docs/README.md << 'EOF'
# HPCé›†ç¾¤æ–‡æ¡£

## æ–‡æ¡£ç»“æ„
- `user_guides/` - ç”¨æˆ·æŒ‡å—
- `admin_guides/` - ç®¡ç†å‘˜æŒ‡å—
- `api_docs/` - APIæ–‡æ¡£
- `faq/` - å¸¸è§é—®é¢˜
- `troubleshooting/` - æ•…éšœæ’é™¤

## æ„å»ºæ–‡æ¡£
```bash
make html
```

## å‘å¸ƒæ–‡æ¡£
æ–‡æ¡£å°†è‡ªåŠ¨å‘å¸ƒåˆ° https://docs.cluster.example.com

## è´¡çŒ®æŒ‡å—
æ¬¢è¿æäº¤æ–‡æ¡£æ”¹è¿›å»ºè®®ï¼š
1. Fork ä»“åº“
2. åˆ›å»ºåˆ†æ”¯
3. æäº¤æ›´æ”¹
4. åˆ›å»º Pull Request
EOF

echo "=== Documentation System Setup Complete ==="
echo "Documentation structure created at: /opt/docs"
echo "Use 'make html' to build documentation"
echo "Online documentation available at configured URL"
```

### 16.2 æŠ€æœ¯æ”¯æŒæµç¨‹

#### 16.2.1 æ”¯æŒçº§åˆ«å®šä¹‰

**å¤šçº§æŠ€æœ¯æ”¯æŒä½“ç³»ï¼š**

```bash
#!/bin/bash
# /opt/support/support_levels.sh

echo "=== HPC Support Levels Configuration ==="

# 1. å®šä¹‰æ”¯æŒçº§åˆ«
echo "1. Defining support levels..."

# L1 - ä¸€çº¿æ”¯æŒï¼ˆHelp Deskï¼‰
cat > /opt/support/levels/l1_support.md << 'EOF'
# L1 - ä¸€çº¿æŠ€æœ¯æ”¯æŒ

## èŒè´£èŒƒå›´
- ç”¨æˆ·è´¦å·é—®é¢˜
- åŸºæœ¬ä½¿ç”¨é—®é¢˜
- å¯†ç é‡ç½®
- è½¯ä»¶å®‰è£…è¯·æ±‚
- ç®€å•æ•…éšœæ’é™¤

## å“åº”æ—¶é—´
- å·¥ä½œæ—¥ï¼š2å°æ—¶å†…å“åº”
- ç´§æ€¥é—®é¢˜ï¼š30åˆ†é’Ÿå†…å“åº”

## å¤„ç†æµç¨‹
1. æ¥æ”¶ç”¨æˆ·è¯·æ±‚
2. åˆæ­¥é—®é¢˜åˆ†ç±»
3. æ ‡å‡†é—®é¢˜ç›´æ¥è§£å†³
4. å¤æ‚é—®é¢˜å‡çº§åˆ°L2

## å¸¸è§é—®é¢˜å¤„ç†
### è´¦å·é—®é¢˜
- å¯†ç é‡ç½®ï¼šä½¿ç”¨è‡ªåŠ©æœåŠ¡ç³»ç»Ÿ
- è´¦å·é”å®šï¼šæ£€æŸ¥ç™»å½•å¤±è´¥æ¬¡æ•°
- æƒé™é—®é¢˜ï¼šæ£€æŸ¥ç”¨æˆ·ç»„è®¾ç½®

### è½¯ä»¶é—®é¢˜
- è½¯ä»¶å®‰è£…ï¼šæ£€æŸ¥æ¨¡å—å¯ç”¨æ€§
- ç¯å¢ƒé…ç½®ï¼šæ£€æŸ¥PATHè®¾ç½®
- ç‰ˆæœ¬å†²çªï¼šæ£€æŸ¥åŠ è½½é¡ºåº

### ç¡¬ä»¶é—®é¢˜
- èŠ‚ç‚¹æ•…éšœï¼šæ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€
- ç½‘ç»œé—®é¢˜ï¼šæµ‹è¯•ç½‘ç»œè¿é€šæ€§
- å­˜å‚¨é—®é¢˜ï¼šæ£€æŸ¥ç£ç›˜ç©ºé—´
EOF

# L2 - äºŒçº¿æ”¯æŒï¼ˆæŠ€æœ¯æ”¯æŒå·¥ç¨‹å¸ˆï¼‰
cat > /opt/support/levels/l2_support.md << 'EOF'
# L2 - äºŒçº¿æŠ€æœ¯æ”¯æŒ

## èŒè´£èŒƒå›´
- å¤æ‚æŠ€æœ¯é—®é¢˜
- æ€§èƒ½ä¼˜åŒ–å»ºè®®
- ä½œä¸šè°ƒåº¦é—®é¢˜
- ç³»ç»Ÿé…ç½®è°ƒæ•´
- ä¸­ç­‰å¤æ‚åº¦æ•…éšœæ’é™¤

## å“åº”æ—¶é—´
- å·¥ä½œæ—¥ï¼š4å°æ—¶å†…å“åº”
- ç´§æ€¥é—®é¢˜ï¼š1å°æ—¶å†…å“åº”

## å¤„ç†æµç¨‹
1. æ¥æ”¶L1å‡çº§é—®é¢˜
2. æ·±å…¥æŠ€æœ¯åˆ†æ
3. å®æ–½è§£å†³æ–¹æ¡ˆ
4. éªŒè¯ä¿®å¤æ•ˆæœ
5. å¿…è¦æ—¶å‡çº§åˆ°L3

## ä¸“ä¸šé¢†åŸŸ
### ä½œä¸šè°ƒåº¦
- SLURMé…ç½®ä¼˜åŒ–
- é˜Ÿåˆ—ç­–ç•¥è°ƒæ•´
- èµ„æºåˆ†é…é—®é¢˜
- ä½œä¸šä¾èµ–ç®¡ç†

### æ€§èƒ½ä¼˜åŒ–
- åº”ç”¨æ€§èƒ½åˆ†æ
- å¹¶è¡Œæ•ˆç‡ä¼˜åŒ–
- I/Oæ€§èƒ½è°ƒä¼˜
- å†…å­˜ä½¿ç”¨ä¼˜åŒ–

### ç³»ç»Ÿç®¡ç†
- æœåŠ¡é…ç½®ä¿®æ”¹
- ç”¨æˆ·æƒé™è°ƒæ•´
- è½¯ä»¶ç¯å¢ƒé…ç½®
- ç›‘æ§ç³»ç»Ÿè®¾ç½®

### æ•…éšœè¯Šæ–­
- ç³»ç»Ÿæ—¥å¿—åˆ†æ
- æ€§èƒ½ç“¶é¢ˆè¯†åˆ«
- ç¡¬ä»¶æ•…éšœå®šä½
- ç½‘ç»œé—®é¢˜æ’æŸ¥
EOF

# L3 - ä¸‰çº¿æ”¯æŒï¼ˆä¸“å®¶æ”¯æŒï¼‰
cat > /opt/support/levels/l3_support.md << 'EOF'
# L3 - ä¸‰çº¿ä¸“å®¶æ”¯æŒ

## èŒè´£èŒƒå›´
- æ¶æ„çº§é—®é¢˜
- æ·±åº¦æ€§èƒ½ä¼˜åŒ–
- å¤æ‚æ•…éšœè¯Šæ–­
- æ–°æŠ€æœ¯è¯„ä¼°
- é‡å¤§ç³»ç»Ÿé—®é¢˜

## å“åº”æ—¶é—´
- å·¥ä½œæ—¥ï¼š8å°æ—¶å†…å“åº”
- ç´§æ€¥é—®é¢˜ï¼š2å°æ—¶å†…å“åº”

## å¤„ç†æµç¨‹
1. æ¥æ”¶L2å‡çº§é—®é¢˜
2. æ·±åº¦æŠ€æœ¯åˆ†æ
3. è®¾è®¡è§£å†³æ–¹æ¡ˆ
4. å®æ–½å’ŒéªŒè¯
5. çŸ¥è¯†è½¬ç§»

## ä¸“å®¶é¢†åŸŸ
### ç³»ç»Ÿæ¶æ„
- é›†ç¾¤æ¶æ„ä¼˜åŒ–
- å­˜å‚¨ç³»ç»Ÿè®¾è®¡
- ç½‘ç»œæ¶æ„è°ƒæ•´
- å®¹é‡è§„åˆ’

### é«˜çº§ä¼˜åŒ–
- ç¼–è¯‘å™¨ä¼˜åŒ–
- æ•°å­¦åº“è°ƒä¼˜
- å¹¶è¡Œç®—æ³•ä¼˜åŒ–
- ç³»ç»Ÿçº§è°ƒä¼˜

### æ–°æŠ€æœ¯
- æ–°ç¡¬ä»¶è¯„ä¼°
- æ–°è½¯ä»¶æµ‹è¯•
- æŠ€æœ¯è¶‹åŠ¿åˆ†æ
- æœ€ä½³å®è·µåˆ¶å®š

### é‡å¤§æ•…éšœ
- ç³»ç»Ÿæ¢å¤
- æ•°æ®æ¢å¤
- ç¾éš¾æ¢å¤
- æ ¹å› åˆ†æ
EOF

# 2. æ”¯æŒå›¢é˜Ÿç»„ç»‡
echo "2. Organizing support team..."

# åˆ›å»ºæ”¯æŒå›¢é˜Ÿé…ç½®
cat > /opt/support/team/organization.yaml << 'EOF'
support_team:
  structure:
    - level: L1
      roles:
        - title: Help Desk Specialist
          count: 2
          shift_hours: "8:00-18:00"
          skills: ["Basic Linux", "User Support", "Ticket Management"]

    - level: L2
      roles:
        - title: Technical Support Engineer
          count: 3
          shift_hours: "8:00-18:00"
          skills: ["Advanced Linux", "SLURM", "Performance Tuning", "Scripting"]
        - title: System Administrator
          count: 2
          shift_hours: "9:00-17:00"
          skills: ["System Administration", "Network Management", "Security"]

    - level: L3
      roles:
        - title: Senior Support Engineer
          count: 2
          shift_hours: "9:00-17:00"
          skills: ["HPC Architecture", "Advanced Troubleshooting", "Performance Analysis"]
        - title: HPC Architect
          count: 1
          shift_hours: "9:00-17:00"
          skills: ["System Design", "Capacity Planning", "Technology Evaluation"]

  escalation:
    l1_to_l2: "After 2 hours or complex technical issue"
    l2_to_l3: "After 4 hours or architecture-level problem"
    emergency: "Immediate escalation for critical system issues"

  coverage:
    weekdays: "8:00-18:00"
    weekends: "Emergency support only"
    holidays: "Emergency support only"
EOF

# 3. æ”¯æŒå·¥å…·é…ç½®
echo "3. Configuring support tools..."

# å·¥å•ç³»ç»Ÿé…ç½®
cat > /opt/support/tools/ticket_system.md << 'EOF'
# å·¥å•ç³»ç»Ÿé…ç½®

## ç³»ç»Ÿé€‰æ‹©
æ¨èä½¿ç”¨ï¼šZammad, JIRA Service Management, æˆ–å¼€æºçš„OTRS

## å·¥å•åˆ†ç±»
### æŒ‰é—®é¢˜ç±»å‹
- Account (è´¦å·é—®é¢˜)
- Software (è½¯ä»¶é—®é¢˜)
- Hardware (ç¡¬ä»¶é—®é¢˜)
- Performance (æ€§èƒ½é—®é¢˜)
- Network (ç½‘ç»œé—®é¢˜)
- Storage (å­˜å‚¨é—®é¢˜)
- Other (å…¶ä»–é—®é¢˜)

### æŒ‰ç´§æ€¥ç¨‹åº¦
- Critical (P1) - ç³»ç»Ÿå®Œå…¨ä¸å¯ç”¨
- High (P2) - éƒ¨åˆ†åŠŸèƒ½å—å½±å“
- Medium (P3) - åŠŸèƒ½å—é™ä½†å¯å·¥ä½œ
- Low (P4) - ä¿¡æ¯å’¨è¯¢ç±»é—®é¢˜

### æŒ‰å¤„ç†çŠ¶æ€
- New (æ–°å»º)
- In Progress (å¤„ç†ä¸­)
- Pending (ç­‰å¾…ç”¨æˆ·)
- Resolved (å·²è§£å†³)
- Closed (å·²å…³é—­)

## è‡ªåŠ¨åŒ–è§„åˆ™
### å·¥å•åˆ†é…
- æ–°å·¥å•æŒ‰ç±»å‹è‡ªåŠ¨åˆ†é…ç»™ç›¸åº”æ”¯æŒçº§åˆ«
- ç´§æ€¥å·¥å•ç«‹å³é€šçŸ¥å€¼ç­äººå‘˜
- é‡å¤é—®é¢˜è‡ªåŠ¨å…³è”

### é€šçŸ¥è§„åˆ™
- å·¥å•çŠ¶æ€å˜æ›´æ—¶é€šçŸ¥ç”¨æˆ·
- è¶…æ—¶å·¥å•è‡ªåŠ¨å‡çº§
- å®šæœŸå‘é€å·¥å•çŠ¶æ€æŠ¥å‘Š

### SLAç›‘æ§
- è‡ªåŠ¨è·Ÿè¸ªå“åº”æ—¶é—´
- è¶…æ—¶å·¥å•é¢„è­¦
- SLAè¾¾æˆç‡ç»Ÿè®¡
EOF

# 4. æœåŠ¡æµç¨‹æ ‡å‡†åŒ–
echo "4. Standardizing service processes..."

# åˆ›å»ºæ ‡å‡†æ“ä½œæµç¨‹
cat > /opt/support/processes/sop.md << 'EOF'
# æ ‡å‡†æ“ä½œæµç¨‹ (SOP)

## å·¥å•å¤„ç†æµç¨‹
```
ç”¨æˆ·æäº¤å·¥å•
    â†“
è‡ªåŠ¨åˆ†ç±»å’Œåˆ†é…
    â†“
L1æ”¯æŒæ¥æ”¶
    â†“
åˆæ­¥åˆ†æå’Œå°è¯•è§£å†³
    â†“
æ˜¯å¦è§£å†³ï¼Ÿ
    â†“ æ˜¯
    å·¥å•å…³é—­
    â†“ å¦
    é—®é¢˜å‡çº§åˆ°L2
    â†“
L2æ”¯æŒåˆ†æ
    â†“
å®æ–½è§£å†³æ–¹æ¡ˆ
    â†“
æ˜¯å¦è§£å†³ï¼Ÿ
    â†“ æ˜¯
    å·¥å•å…³é—­
    â†“ å¦
    é—®é¢˜å‡çº§åˆ°L3
    â†“
L3ä¸“å®¶åˆ†æ
    â†“
å®æ–½è§£å†³æ–¹æ¡ˆ
    â†“
å·¥å•å…³é—­
```

## ç´§æ€¥äº‹ä»¶å¤„ç†æµç¨‹
```
ç´§æ€¥äº‹ä»¶å‘ç”Ÿ
    â†“
ç«‹å³é€šçŸ¥å€¼ç­ä¸»ç®¡
    â†“
å¯åŠ¨åº”æ€¥å“åº”å°ç»„
    â†“
é—®é¢˜è¯Šæ–­å’Œå®šä½
    â†“
åˆ¶å®šè§£å†³æ–¹æ¡ˆ
    â†“
å®æ–½ä¿®å¤
    â†“
éªŒè¯ä¿®å¤æ•ˆæœ
    â†“
äº‹ä»¶æ€»ç»“å’ŒæŠ¥å‘Š
```

## å¸¸è§é—®é¢˜å¤„ç†SOP
### å¯†ç é‡ç½®
1. éªŒè¯ç”¨æˆ·èº«ä»½
2. æ£€æŸ¥è´¦å·çŠ¶æ€
3. é‡ç½®å¯†ç 
4. é€šçŸ¥ç”¨æˆ·
5. è®°å½•å¤„ç†è¿‡ç¨‹

### è½¯ä»¶å®‰è£…è¯·æ±‚
1. ç¡®è®¤è½¯ä»¶éœ€æ±‚
2. æ£€æŸ¥è®¸å¯è¯çŠ¶æ€
3. è¯„ä¼°å®‰è£…å¯è¡Œæ€§
4. åˆ¶å®šå®‰è£…è®¡åˆ’
5. å®æ–½å®‰è£…
6. éªŒè¯åŠŸèƒ½
7. æ›´æ–°æ–‡æ¡£

### æ€§èƒ½é—®é¢˜
1. æ”¶é›†æ€§èƒ½æ•°æ®
2. åˆ†ææ€§èƒ½ç“¶é¢ˆ
3. åˆ¶å®šä¼˜åŒ–æ–¹æ¡ˆ
4. å®æ–½ä¼˜åŒ–æªæ–½
5. éªŒè¯ä¼˜åŒ–æ•ˆæœ
6. ç¼–å†™ä¼˜åŒ–æŠ¥å‘Š
EOF

echo "=== Support Levels Configuration Complete ==="
echo "Support levels defined and configured"
echo "Team organization structure created"
echo "Standard operating procedures documented"
```

#### 16.2.2 å·¥å•ç®¡ç†ç³»ç»Ÿ

**å·¥å•ç³»ç»Ÿè‡ªåŠ¨åŒ–è„šæœ¬ï¼š**

```bash
#!/bin/bash
# /opt/support/ticket_system_automation.sh

echo "=== Ticket System Automation Setup ==="

# 1. å·¥å•åˆ†ç±»è‡ªåŠ¨åŒ–
echo "1. Setting up ticket classification automation..."

# åˆ›å»ºå·¥å•åˆ†ç±»è„šæœ¬
cat > /opt/support/automation/classify_ticket.py << 'EOF'
#!/usr/bin/env python3
"""
å·¥å•è‡ªåŠ¨åˆ†ç±»è„šæœ¬
æ ¹æ®å·¥å•å†…å®¹è‡ªåŠ¨åˆ†ç±»å’Œåˆ†é…
"""

import re
import json

class TicketClassifier:
    def __init__(self):
        self.classification_rules = {
            'account': [
                r'(?i)password|passwd|login|authentication|auth',
                r'(?i)account|user|username',
                r'(?i)access|permission|privilege'
            ],
            'software': [
                r'(?i)software|program|application|app',
                r'(?i)install|uninstall|setup|configure',
                r'(?i)module|environment|path'
            ],
            'hardware': [
                r'(?i)hardware|hardware|node|server',
                r'(?i)cpu|memory|ram|disk|storage',
                r'(?i)network|network|connection'
            ],
            'performance': [
                r'(?i)slow|performance|speed|efficiency',
                r'(?i)optimization|tune|optimize',
                r'(?i)bottleneck|limitation|constraint'
            ]
        }

        self.priority_rules = {
            'critical': [
                r'(?i)down|crash|fail|error|broken',
                r'(?i)emergency|urgent|immediate',
                r'(?i)cant work|stop working'
            ],
            'high': [
                r'(?i)difficult|trouble|problem',
                r'(?i)affect|impact|prevent',
                r'(?i)many users|multiple users'
            ],
            'medium': [
                r'(?i)help|assistance|support',
                r'(?i)how to|what is|where is',
                r'(?i)recommendation|suggestion|advice'
            ]
        }

    def classify(self, title, description):
        """åˆ†ç±»å·¥å•"""
        text = f"{title} {description}".lower()

        # åˆ†ç±»
        category_score = {}
        for category, patterns in self.classification_rules.items():
            score = 0
            for pattern in patterns:
                if re.search(pattern, text):
                    score += 1
            category_score[category] = score

        category = max(category_score, key=category_score.get) if max(category_score.values()) > 0 else 'other'

        # ä¼˜å…ˆçº§
        priority_score = {}
        for priority, patterns in self.priority_rules.items():
            score = 0
            for pattern in patterns:
                if re.search(pattern, text):
                    score += 1
            priority_score[priority] = score

        priority = max(priority_score, key=priority_score.get) if max(priority_score.values()) > 0 else 'low'

        return {
            'category': category,
            'priority': priority,
            'confidence': max(category_score.values()) + max(priority_score.values())
        }

    def assign_support_level(self, category, priority):
        """åˆ†é…æ”¯æŒçº§åˆ«"""
        if priority == 'critical':
            return 'L3'
        elif category in ['hardware', 'performance'] and priority in ['high', 'medium']:
            return 'L2'
        else:
            return 'L1'

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    classifier = TicketClassifier()

    # æµ‹è¯•å·¥å•
    test_tickets = [
        {
            "title": "Can't login to cluster",
            "description": "I can't login to the cluster, password reset not working"
        },
        {
            "title": "Performance issue with my job",
            "description": "My MPI job is running very slow, need help to optimize"
        }
    ]

    for ticket in test_tickets:
        result = classifier.classify(ticket['title'], ticket['description'])
        support_level = classifier.assign_support_level(result['category'], result['priority'])

        print(f"Ticket: {ticket['title']}")
        print(f"Category: {result['category']}")
        print(f"Priority: {result['priority']}")
        print(f"Support Level: {support_level}")
        print("---")
EOF

chmod +x /opt/support/automation/classify_ticket.py

# 2. å·¥å•åˆ†é…è‡ªåŠ¨åŒ–
echo "2. Setting up ticket assignment automation..."

# åˆ›å»ºå·¥å•åˆ†é…è„šæœ¬
cat > /opt/support/automation/assign_ticket.py << 'EOF'
#!/usr/bin/env python3
"""
å·¥å•è‡ªåŠ¨åˆ†é…è„šæœ¬
æ ¹æ®æ”¯æŒçº§åˆ«ã€æŠ€èƒ½å’Œè´Ÿè½½è‡ªåŠ¨åˆ†é…å·¥å•
"""

import json
import random
from datetime import datetime, timedelta

class TicketAssigner:
    def __init__(self):
        # æ”¯æŒå›¢é˜Ÿé…ç½®
        self.team_config = {
            'L1': [
                {'id': 'l1_001', 'name': 'Alice Johnson', 'skills': ['basic_linux', 'user_support'], 'load': 0},
                {'id': 'l1_002', 'name': 'Bob Smith', 'skills': ['basic_linux', 'ticket_mgmt'], 'load': 0},
            ],
            'L2': [
                {'id': 'l2_001', 'name': 'Carol Davis', 'skills': ['advanced_linux', 'slurm', 'performance'], 'load': 0},
                {'id': 'l2_002', 'name': 'David Wilson', 'skills': ['system_admin', 'network', 'storage'], 'load': 0},
                {'id': 'l2_003', 'name': 'Eve Brown', 'skills': ['scripting', 'monitoring', 'security'], 'load': 0},
            ],
            'L3': [
                {'id': 'l3_001', 'name': 'Frank Miller', 'skills': ['hpc_architecture', 'advanced_troubleshooting'], 'load': 0},
                {'id': 'l3_002', 'name': 'Grace Lee', 'skills': ['performance_analysis', 'system_design'], 'load': 0},
            ]
        }

        # æŠ€èƒ½åŒ¹é…æƒé‡
        self.skill_weights = {
            'account': ['basic_linux', 'user_support'],
            'software': ['basic_linux', 'scripting'],
            'hardware': ['advanced_linux', 'system_admin'],
            'performance': ['performance', 'advanced_troubleshooting'],
            'network': ['network', 'system_admin'],
            'storage': ['storage', 'system_admin'],
            'other': ['user_support', 'ticket_mgmt']
        }

    def calculate_skill_match(self, agent, ticket_category):
        """è®¡ç®—æŠ€èƒ½åŒ¹é…åº¦"""
        agent_skills = set(agent['skills'])
        required_skills = set(self.skill_weights.get(ticket_category, []))

        if not required_skills:
            return 0.5  # é»˜è®¤åŒ¹é…åº¦

        match_count = len(agent_skills.intersection(required_skills))
        total_required = len(required_skills)

        return match_count / total_required

    def select_agent(self, support_level, ticket_category):
        """é€‰æ‹©æœ€åˆé€‚çš„ä»£ç†"""
        available_agents = self.team_config.get(support_level, [])

        if not available_agents:
            return None

        # è®¡ç®—æ¯ä¸ªä»£ç†çš„ç»¼åˆè¯„åˆ†
        agent_scores = []
        for agent in available_agents:
            skill_match = self.calculate_skill_match(agent, ticket_category)
            load_penalty = agent['load'] * 0.1  # è´Ÿè½½æƒ©ç½š

            score = skill_match - load_penalty
            agent_scores.append((agent, score))

        # é€‰æ‹©è¯„åˆ†æœ€é«˜çš„ä»£ç†
        best_agent = max(agent_scores, key=lambda x: x[1])[0]

        # å¢åŠ ä»£ç†è´Ÿè½½
        best_agent['load'] += 1

        return best_agent

    def assign_ticket(self, ticket_data):
        """åˆ†é…å·¥å•"""
        category = ticket_data.get('category', 'other')
        priority = ticket_data.get('priority', 'medium')
        support_level = ticket_data.get('support_level', 'L1')

        agent = self.select_agent(support_level, category)

        if agent:
            assignment = {
                'ticket_id': ticket_data.get('ticket_id'),
                'assigned_to': agent['id'],
                'assigned_name': agent['name'],
                'support_level': support_level,
                'category': category,
                'priority': priority,
                'assignment_time': datetime.now().isoformat(),
                'expected_response_time': self.get_response_time(priority, support_level)
            }

            return assignment
        else:
            return {'error': 'No available agent'}

    def get_response_time(self, priority, support_level):
        """è·å–é¢„æœŸå“åº”æ—¶é—´"""
        response_times = {
            'L1': {'critical': '30m', 'high': '2h', 'medium': '4h', 'low': '8h'},
            'L2': {'critical': '1h', 'high': '4h', 'medium': '8h', 'low': '16h'},
            'L3': {'critical': '2h', 'high': '8h', 'medium': '16h', 'low': '24h'}
        }

        return response_times.get(support_level, {}).get(priority, '8h')

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    assigner = TicketAssigner()

    # æµ‹è¯•å·¥å•
    test_tickets = [
        {'ticket_id': 'T001', 'category': 'account', 'priority': 'high', 'support_level': 'L1'},
        {'ticket_id': 'T002', 'category': 'performance', 'priority': 'critical', 'support_level': 'L3'},
        {'ticket_id': 'T003', 'category': 'hardware', 'priority': 'medium', 'support_level': 'L2'}
    ]

    for ticket in test_tickets:
        assignment = assigner.assign_ticket(ticket)
        print(f"Ticket {assignment['ticket_id']} assigned to {assignment['assigned_name']} ({assignment['support_level']})")
        print(f"Expected response time: {assignment['expected_response_time']}")
        print("---")
EOF

chmod +x /opt/support/automation/assign_ticket.py

# 3. å·¥å•çŠ¶æ€ç›‘æ§
echo "3. Setting up ticket status monitoring..."

# åˆ›å»ºå·¥å•ç›‘æ§è„šæœ¬
cat > /opt/support/automation/monitor_tickets.sh << 'EOF'
#!/bin/bash
# å·¥å•çŠ¶æ€ç›‘æ§è„šæœ¬

echo "=== Ticket Status Monitoring ==="

# 1. æ£€æŸ¥è¶…æ—¶å·¥å•
echo "1. Checking overdue tickets..."

# æ¨¡æ‹ŸæŸ¥è¯¢è¶…æ—¶å·¥å•ï¼ˆå®é™…ä½¿ç”¨æ—¶æ›¿æ¢ä¸ºçœŸå®çš„APIè°ƒç”¨ï¼‰
check_overdue_tickets() {
    echo "Checking for overdue tickets..."

    # è¿™é‡Œåº”è¯¥è°ƒç”¨å·¥å•ç³»ç»Ÿçš„API
    # ç¤ºä¾‹ï¼šcurl -s "https://ticketsystem/api/tickets?status=open" | jq '.tickets[]'

    # æ¨¡æ‹Ÿæ•°æ®
    echo "Simulated overdue tickets check"
    echo "T001 - Account issue - 4 hours overdue"
    echo "T002 - Performance issue - 2 hours overdue"
}

# 2. ç”Ÿæˆå·¥å•ç»Ÿè®¡æŠ¥å‘Š
echo "2. Generating ticket statistics..."

generate_ticket_report() {
    echo "Generating ticket statistics report..."

    # ç»Ÿè®¡å„çŠ¶æ€å·¥å•æ•°é‡
    echo "=== Ticket Statistics Report ==="
    echo "Date: $(date)"
    echo ""

    echo "By Status:"
    echo "- New: 15"
    echo "- In Progress: 8"
    echo "- Pending: 3"
    echo "- Resolved: 25"
    echo "- Closed: 42"
    echo ""

    echo "By Category:"
    echo "- Account: 20"
    echo "- Software: 18"
    echo "- Hardware: 12"
    echo "- Performance: 15"
    echo "- Network: 8"
    echo "- Storage: 10"
    echo ""

    echo "By Priority:"
    echo "- Critical: 5"
    echo "- High: 12"
    echo "- Medium: 28"
    echo "- Low: 48"
    echo ""

    echo "SLA Compliance:"
    echo "- L1 Response Time: 95%"
    echo "- L2 Response Time: 88%"
    echo "- L3 Response Time: 92%"
    echo "- Overall Resolution Time: 4.2 hours"
}

# 3. å‘é€é€šçŸ¥
send_notifications() {
    echo "3. Sending notifications..."

    # å‘é€è¶…æ—¶å·¥å•é€šçŸ¥
    echo "Sending overdue ticket notifications..."

    # é‚®ä»¶é€šçŸ¥
    echo "Subject: Overdue Tickets Alert" | \
    mail -s "Overdue Tickets Alert" support-team@hpc.example.com << EOF
    Dear Support Team,

    The following tickets are overdue and require immediate attention:

    T001 - Account issue - 4 hours overdue
    T002 - Performance issue - 2 hours overdue

    Please take action to resolve these issues.

    Best regards,
    Ticket Monitoring System
EOF

    # Slacké€šçŸ¥ï¼ˆå¦‚æœæœ‰ï¼‰
    # curl -X POST -H 'Content-type: application/json' \
    #     --data '{"text":"Overdue tickets detected: T001, T002"}' \
    #     https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK
}

# 4. ä¸»ç›‘æ§å¾ªç¯
main_monitoring() {
    echo "Starting ticket monitoring..."

    while true; do
        echo "=== Monitoring Cycle: $(date) ==="

        check_overdue_tickets
        echo ""

        generate_ticket_report
        echo ""

        send_notifications
        echo ""

        # æ¯30åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
        echo "Waiting 30 minutes for next check..."
        sleep 1800
    done
}

# è¿è¡Œç›‘æ§ï¼ˆå¯é€‰ï¼Œé€šå¸¸ä½œä¸ºåå°æœåŠ¡è¿è¡Œï¼‰
# main_monitoring

echo "=== Ticket Monitoring Setup Complete ==="
echo "Scripts created for automated ticket management"
echo "Run main_monitoring() function to start monitoring"
EOF

chmod +x /opt/support/automation/monitor_tickets.sh

echo "=== Ticket System Automation Setup Complete ==="
echo "Classification, assignment, and monitoring scripts created"
echo "Integration with actual ticket system required for full automation"
```

#### 16.2.3 æœåŠ¡çº§åˆ«åè®®ï¼ˆSLAï¼‰

**SLAç®¡ç†è„šæœ¬ï¼š**

```bash
#!/bin/bash
# /opt/support/sla_management.sh

echo "=== SLA Management System ==="

# 1. SLAå®šä¹‰
echo "1. Defining SLA parameters..."

# åˆ›å»ºSLAé…ç½®æ–‡ä»¶
cat > /opt/support/sla/definitions.yaml << 'EOF'
# HPC Support SLA Definitions

sla_levels:
  L1_support:
    response_time:
      critical: "30 minutes"
      high: "2 hours"
      medium: "4 hours"
      low: "8 hours"

    resolution_time:
      critical: "4 hours"
      high: "8 hours"
      medium: "24 hours"
      low: "72 hours"

    availability: "99.5%"
    coverage: "Monday-Friday, 8:00-18:00"

  L2_support:
    response_time:
      critical: "1 hour"
      high: "4 hours"
      medium: "8 hours"
      low: "16 hours"

    resolution_time:
      critical: "8 hours"
      high: "24 hours"
      medium: "48 hours"
      low: "96 hours"

    availability: "99.8%"
    coverage: "Monday-Friday, 8:00-18:00"

  L3_support:
    response_time:
      critical: "2 hours"
      high: "8 hours"
      medium: "16 hours"
      low: "24 hours"

    resolution_time:
      critical: "24 hours"
      high: "48 hours"
      medium: "72 hours"
      low: "120 hours"

    availability: "99.9%"
    coverage: "24/7 (emergency only)"

emergency_support:
  definition: "Critical system failures affecting multiple users"
  response_time: "15 minutes"
  escalation_path: "L1 -> L2 -> L3 -> Management"
  contact_methods:
    - phone: "400-xxx-xxxx"
    - email: "emergency@hpc.example.com"
    - pager: "Available 24/7"

penalties:
  response_time_breach:
    warning_threshold: "1% of tickets"
    penalty_threshold: "5% of tickets"
    actions:
      - warning: "Formal warning letter"
      - penalty: "Service credit"
      - termination: "Contract review"

  resolution_time_breach:
    warning_threshold: "2% of tickets"
    penalty_threshold: "8% of tickets"
    actions:
      - warning: "Process improvement plan"
      - penalty: "Service credit"
      - termination: "Contract review"
EOF

# 2. SLAç›‘æ§è„šæœ¬
echo "2. Creating SLA monitoring script..."

cat > /opt/support/sla/monitor.py << 'EOF'
#!/usr/bin/env python3
"""
SLAç›‘æ§è„šæœ¬
å®æ—¶ç›‘æ§SLAæŒ‡æ ‡å¹¶ç”ŸæˆæŠ¥å‘Š
"""

import json
import time
from datetime import datetime, timedelta
import yaml

class SLAMonitor:
    def __init__(self, config_file):
        with open(config_file, 'r') as f:
            self.config = yaml.safe_load(f)

        self.metrics = {
            'response_time': [],
            'resolution_time': [],
            'availability': [],
            'satisfaction': []
        }

    def calculate_response_time_sla(self, ticket_data):
        """è®¡ç®—å“åº”æ—¶é—´SLA"""
        created_time = datetime.fromisoformat(ticket_data['created_at'])
        responded_time = datetime.fromisoformat(ticket_data['responded_at'])
        response_time = (responded_time - created_time).total_seconds() / 3600

        priority = ticket_data['priority']
        support_level = ticket_data['support_level']

        sla_limit = self.get_sla_limit(support_level, 'response_time', priority)

        return {
            'ticket_id': ticket_data['ticket_id'],
            'response_time': response_time,
            'sla_limit': sla_limit,
            'compliant': response_time <= sla_limit,
            'breach_time': max(0, response_time - sla_limit)
        }

    def calculate_resolution_time_sla(self, ticket_data):
        """è®¡ç®—è§£å†³æ—¶é—´SLA"""
        created_time = datetime.fromisoformat(ticket_data['created_at'])
        resolved_time = datetime.fromisoformat(ticket_data['resolved_at'])
        resolution_time = (resolved_time - created_time).total_seconds() / 3600

        priority = ticket_data['priority']
        support_level = ticket_data['support_level']

        sla_limit = self.get_sla_limit(support_level, 'resolution_time', priority)

        return {
            'ticket_id': ticket_data['ticket_id'],
            'resolution_time': resolution_time,
            'sla_limit': sla_limit,
            'compliant': resolution_time <= sla_limit,
            'breach_time': max(0, resolution_time - sla_limit)
        }

    def get_sla_limit(self, support_level, metric_type, priority):
        """è·å–SLAé™åˆ¶"""
        sla_config = self.config['sla_levels'][support_level][metric_type]
        return sla_config[priority]

    def monitor_sla_compliance(self, time_window_hours=24):
        """ç›‘æ§SLAåˆè§„æ€§"""
        # æ¨¡æ‹Ÿè·å–å·¥å•æ•°æ®
        # å®é™…ä½¿ç”¨æ—¶åº”è¯¥ä»å·¥å•ç³»ç»ŸAPIè·å–
        mock_tickets = self.generate_mock_data(time_window_hours)

        response_compliance = []
        resolution_compliance = []

        for ticket in mock_tickets:
            # è®¡ç®—å“åº”æ—¶é—´åˆè§„æ€§
            response_result = self.calculate_response_time_sla(ticket)
            response_compliance.append(response_result['compliant'])

            # è®¡ç®—è§£å†³æ—¶é—´åˆè§„æ€§ï¼ˆä»…å¤„ç†å·²è§£å†³çš„å·¥å•ï¼‰
            if ticket.get('resolved_at'):
                resolution_result = self.calculate_resolution_time_sla(ticket)
                resolution_compliance.append(resolution_result['compliant'])

        # è®¡ç®—åˆè§„ç‡
        response_sla_rate = sum(response_compliance) / len(response_compliance) if response_compliance else 0
        resolution_sla_rate = sum(resolution_compliance) / len(resolution_compliance) if resolution_compliance else 0

        return {
            'time_window': f"{time_window_hours} hours",
            'response_sla_compliance': response_sla_rate,
            'resolution_sla_compliance': resolution_sla_rate,
            'total_tickets': len(mock_tickets),
            'breached_tickets': {
                'response': len([r for r in response_compliance if not r]),
                'resolution': len([r for r in resolution_compliance if not r])
            }
        }

    def generate_mock_data(self, hours):
        """ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®ç”¨äºæµ‹è¯•"""
        tickets = []
        current_time = datetime.now()

        for i in range(50):
            # éšæœºç”Ÿæˆå·¥å•æ•°æ®
            created_time = current_time - timedelta(hours=random.randint(1, hours))
            priority = random.choice(['critical', 'high', 'medium', 'low'])
            support_level = random.choice(['L1', 'L2', 'L3'])

            ticket = {
                'ticket_id': f"T{1000 + i}",
                'created_at': created_time.isoformat(),
                'priority': priority,
                'support_level': support_level
            }

            # éšæœºç”Ÿæˆå“åº”æ—¶é—´
            if random.random() > 0.1:  # 90%çš„å·¥å•æœ‰å“åº”
                response_delay = random.randint(1, 12)  # 1-12å°æ—¶å“åº”
                ticket['responded_at'] = (created_time + timedelta(hours=response_delay)).isoformat()

            # éšæœºç”Ÿæˆè§£å†³æ—¶é—´
            if random.random() > 0.3:  # 70%çš„å·¥å•å·²è§£å†³
                resolution_delay = random.randint(2, 48)  # 2-48å°æ—¶è§£å†³
                ticket['resolved_at'] = (created_time + timedelta(hours=resolution_delay)).isoformat()

            tickets.append(ticket)

        return tickets

    def generate_sla_report(self):
        """ç”ŸæˆSLAæŠ¥å‘Š"""
        report = {
            'report_time': datetime.now().isoformat(),
            'summary': {},
            'detailed_metrics': {},
            'alerts': [],
            'recommendations': []
        }

        # ç›‘æ§ä¸åŒæ—¶é—´çª—å£
        time_windows = [1, 4, 8, 24]

        for window in time_windows:
            compliance = self.monitor_sla_compliance(window)
            report['detailed_metrics'][f'{window}_hours'] = compliance

            # æ£€æŸ¥æ˜¯å¦éœ€è¦å‘Šè­¦
            if compliance['response_sla_compliance'] < 0.95:
                report['alerts'].append({
                    'level': 'warning',
                    'message': f'Response SLA compliance below 95% for {window}h window: {compliance["response_sla_compliance"]:.2%}'
                })

            if compliance['resolution_sla_compliance'] < 0.90:
                report['alerts'].append({
                    'level': 'critical',
                    'message': f'Resolution SLA compliance below 90% for {window}h window: {compliance["resolution_sla_compliance"]:.2%}'
                })

        # ç”Ÿæˆæ€»ç»“
        latest_compliance = report['detailed_metrics']['24_hours']
        report['summary'] = {
            'overall_response_sla': latest_compliance['response_sla_compliance'],
            'overall_resolution_sla': latest_compliance['resolution_sla_compliance'],
            'total_tickets': latest_compliance['total_tickets'],
            'breach_count': latest_compliance['breached_tickets']
        }

        # ç”Ÿæˆå»ºè®®
        if latest_compliance['response_sla_compliance'] < 0.95:
            report['recommendations'].append("Consider increasing L1 support staff during peak hours")

        if latest_compliance['resolution_sla_compliance'] < 0.90:
            report['recommendations'].append("Review L2/L3 escalation procedures and response times")

        return report

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    monitor = SLAMonitor('/opt/support/sla/definitions.yaml')

    # ç”ŸæˆSLAæŠ¥å‘Š
    report = monitor.generate_sla_report()

    # è¾“å‡ºæŠ¥å‘Š
    print("=== SLA Compliance Report ===")
    print(f"Report Time: {report['report_time']}")
    print(f"Response SLA Compliance: {report['summary']['overall_response_sla']:.2%}")
    print(f"Resolution SLA Compliance: {report['summary']['overall_resolution_sla']:.2%}")
    print(f"Total Tickets: {report['summary']['total_tickets']}")
    print(f"Breach Count: {report['summary']['breach_count']}")

    if report['alerts']:
        print("\n=== Alerts ===")
        for alert in report['alerts']:
            print(f"{alert['level'].upper()}: {alert['message']}")

    if report['recommendations']:
        print("\n=== Recommendations ===")
        for rec in report['recommendations']:
            print(f"- {rec}")
EOF

# 3. SLAæŠ¥å‘Šç”Ÿæˆ
echo "3. Creating SLA report generation..."

cat > /opt/support/sla/generate_report.sh << 'EOF'
#!/bin/bash
# SLAæŠ¥å‘Šç”Ÿæˆè„šæœ¬

echo "=== SLA Report Generation ==="

# 1. ç”Ÿæˆæ—¥æŠ¥
generate_daily_report() {
    echo "Generating daily SLA report..."

    python3 /opt/support/sla/monitor.py > /tmp/sla_daily_report.json

    # æ ¼å¼åŒ–è¾“å‡º
    cat > /opt/support/sla/daily_report.html << 'HTML_EOF'
<!DOCTYPE html>
<html>
<head>
    <title>Daily SLA Report</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .header { background-color: #f0f0f0; padding: 20px; border-radius: 5px; }
        .metric { display: inline-block; margin: 10px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .compliant { background-color: #d4edda; color: #155724; }
        .warning { background-color: #fff3cd; color: #856404; }
        .critical { background-color: #f8d7da; color: #721c24; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Daily SLA Report</h1>
        <p>Generated: $(date)</p>
    </div>

    <div class="metrics">
        <div class="metric compliant">
            <h3>Response Time SLA</h3>
            <p>Compliance Rate: 95%</p>
            <p>Breaches: 2</p>
        </div>

        <div class="metric compliant">
            <h3>Resolution Time SLA</h3>
            <p>Compliance Rate: 92%</p>
            <p>Breaches: 3</p>
        </div>

        <div class="metric warning">
            <h3>System Availability</h3>
            <p>Uptime: 99.5%</p>
            <p>Downtime: 30 minutes</p>
        </div>
    </div>

    <h2>Detailed Statistics</h2>
    <table>
        <tr>
            <th>Time Window</th>
            <th>Total Tickets</th>
            <th>Response SLA</th>
            <th>Resolution SLA</th>
            <th>Response Breaches</th>
            <th>Resolution Breaches</th>
        </tr>
        <tr>
            <td>1 hour</td>
            <td>15</td>
            <td>100%</td>
            <td>N/A</td>
            <td>0</td>
            <td>0</td>
        </tr>
        <tr>
            <td>4 hours</td>
            <td>35</td>
            <td>97%</td>
            <td>95%</td>
            <td>1</td>
            <td>2</td>
        </tr>
        <tr>
            <td>24 hours</td>
            <td>120</td>
            <td>95%</td>
            <td>92%</td>
            <td>6</td>
            <td>9</td>
        </tr>
    </table>

    <h2>Incidents</h2>
    <p>No critical incidents reported today.</p>

    <h2>Recommendations</h2>
    <ul>
        <li>Monitor response times during peak hours (10:00-12:00)</li>
        <li>Review L2 escalation procedures for complex issues</li>
        <li>Consider additional training for new support staff</li>
    </ul>
</body>
</html>
HTML_EOF

    # å‘é€é‚®ä»¶æŠ¥å‘Š
    mail -s "Daily SLA Report - $(date +%Y-%m-%d)" support-manager@hpc.example.com < /opt/support/sla/daily_report.html
}

# 2. ç”Ÿæˆå‘¨æŠ¥
generate_weekly_report() {
    echo "Generating weekly SLA report..."

    # è¿™é‡Œå¯ä»¥é›†æˆå®é™…çš„æ•°æ®æ”¶é›†å’Œåˆ†æ
    echo "Weekly report generation would include:"
    echo "- Weekly SLA compliance trends"
    echo "- Monthly comparison statistics"
    echo "- Customer satisfaction survey results"
    echo "- SLA breach analysis and recommendations"
}

# 3. ç”ŸæˆæœˆæŠ¥
generate_monthly_report() {
    echo "Generating monthly SLA report..."

    # æœˆåº¦æŠ¥å‘ŠåŒ…å«æ›´è¯¦ç»†çš„åˆ†æ
    echo "Monthly report would include:"
    echo "- Monthly SLA performance summary"
    echo "- Trend analysis over time"
    echo "- SLA improvement recommendations"
    echo "- Customer feedback analysis"
    echo "- Service credit calculations"
}

# ä¸»å‡½æ•°
main() {
    case "$1" in
        "daily")
            generate_daily_report
            ;;
        "weekly")
            generate_weekly_report
            ;;
        "monthly")
            generate_monthly_report
            ;;
        *)
            echo "Usage: $0 {daily|weekly|monthly}"
            echo "Example: $0 daily"
            ;;
    esac
}

# è¿è¡Œä¸»å‡½æ•°
main "$@"
EOF

chmod +x /opt/support/sla/generate_report.sh

echo "=== SLA Management System Setup Complete ==="
echo "SLA definitions configured"
echo "Monitoring and reporting scripts created"
echo "Integration with ticket system required for real-time monitoring"
```

## ğŸ“š ç”¨æˆ·æœåŠ¡æœ€ä½³å®è·µ

### 16.3 ç”¨æˆ·é—®é¢˜è¯Šæ–­

#### 16.3.1 é—®é¢˜è¯Šæ–­æµç¨‹

**æ ‡å‡†åŒ–é—®é¢˜è¯Šæ–­æµç¨‹ï¼š**

```bash
#!/bin/bash
# /opt/support/troubleshooting/diagnostic_flow.sh

echo "=== User Problem Diagnostic Flow ==="

# 1. é—®é¢˜æ”¶é›†å’Œåˆ†ç±»
collect_problem_info() {
    echo "1. Collecting problem information..."

    # ç”¨æˆ·ä¿¡æ¯æ”¶é›†
    read -p "è¯·è¾“å…¥ç”¨æˆ·å: " username
    read -p "è¯·è¾“å…¥è”ç³»æ–¹å¼: " contact
    read -p "é—®é¢˜å‘ç”Ÿæ—¶é—´: " problem_time
    read -p "é—®é¢˜æŒç»­æ—¶é—´: " duration

    # é—®é¢˜æè¿°æ”¶é›†
    echo "è¯·è¯¦ç»†æè¿°é‡åˆ°çš„é—®é¢˜:"
    read -r problem_description

    # é—®é¢˜åˆ†ç±»
    echo "è¯·é€‰æ‹©é—®é¢˜ç±»å‹:"
    echo "1. è´¦å·é—®é¢˜"
    echo "2. è½¯ä»¶é—®é¢˜"
    echo "3. ç¡¬ä»¶é—®é¢˜"
    echo "4. æ€§èƒ½é—®é¢˜"
    echo "5. ç½‘ç»œé—®é¢˜"
    echo "6. å…¶ä»–"
    read -p "è¯·é€‰æ‹© (1-6): " problem_type

    case $problem_type in
        1) category="account" ;;
        2) category="software" ;;
        3) category="hardware" ;;
        4) category="performance" ;;
        5) category="network" ;;
        6) category="other" ;;
        *) category="other" ;;
    esac

    # é—®é¢˜ä¸¥é‡ç¨‹åº¦
    echo "è¯·é€‰æ‹©é—®é¢˜ä¸¥é‡ç¨‹åº¦:"
    echo "1. Critical - ç³»ç»Ÿå®Œå…¨ä¸å¯ç”¨"
    echo "2. High - éƒ¨åˆ†åŠŸèƒ½å—å½±å“"
    echo "3. Medium - åŠŸèƒ½å—é™ä½†å¯å·¥ä½œ"
    echo "4. Low - ä¿¡æ¯å’¨è¯¢ç±»"
    read -p "è¯·é€‰æ‹© (1-Critical, 2-High, 3-Medium, 4-Low): " severity

    case $severity in
        1) priority="critical" ;;
        2) priority="high" ;;
        3) priority="medium" ;;
        4) priority="low" ;;
        *) priority="medium" ;;
    esac

    # åˆ›å»ºé—®é¢˜è®°å½•
    problem_id="P$(date +%Y%m%d%H%M%S)"
    echo "Problem ID: $problem_id" > /tmp/problem_$problem_id.txt
    echo "Username: $username" >> /tmp/problem_$problem_id.txt
    echo "Contact: $contact" >> /tmp/problem_$problem_id.txt
    echo "Time: $problem_time" >> /tmp/problem_$problem_id.txt
    echo "Duration: $duration" >> /tmp/problem_$problem_id.txt
    echo "Category: $category" >> /tmp/problem_$problem_id.txt
    echo "Priority: $priority" >> /tmp/problem_$problem_id.txt
    echo "Description: $problem_description" >> /tmp/problem_$problem_id.txt

    echo "é—®é¢˜ID: $problem_id"
    echo "é—®é¢˜ç±»å‹: $category"
    echo "ä¸¥é‡ç¨‹åº¦: $priority"
}

# 2. åˆæ­¥è¯Šæ–­
initial_diagnosis() {
    echo ""
    echo "2. Performing initial diagnosis..."

    problem_id=$1
    category=$(grep "Category:" /tmp/problem_$problem_id.txt | cut -d: -f2 | tr -d ' ')
    username=$(grep "Username:" /tmp/problem_$problem_id.txt | cut -d: -f2 | tr -d ' ')

    case $category in
        "account")
            diagnose_account_issue $username $problem_id
            ;;
        "software")
            diagnose_software_issue $username $problem_id
            ;;
        "hardware")
            diagnose_hardware_issue $username $problem_id
            ;;
        "performance")
            diagnose_performance_issue $username $problem_id
            ;;
        "network")
            diagnose_network_issue $username $problem_id
            ;;
        *)
            echo "æœªçŸ¥é—®é¢˜ç±»å‹ï¼Œéœ€è¦äººå·¥è¯Šæ–­"
            ;;
    esac
}

# 3. è´¦å·é—®é¢˜è¯Šæ–­
diagnose_account_issue() {
    username=$1
    problem_id=$2

    echo "=== è´¦å·é—®é¢˜è¯Šæ–­ ==="

    # æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨
    if id $username &>/dev/null; then
        echo "âœ“ ç”¨æˆ· $username å­˜åœ¨"
        echo "ç”¨æˆ·ä¿¡æ¯:" >> /tmp/problem_$problem_id.txt
        id $username >> /tmp/problem_$problem_id.txt
    else
        echo "âœ— ç”¨æˆ· $username ä¸å­˜åœ¨"
        echo "å»ºè®®: è¯·æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦æ­£ç¡®æˆ–ç”³è¯·æ–°è´¦å·" >> /tmp/problem_$problem_id.txt
        return 1
    fi

    # æ£€æŸ¥è´¦å·çŠ¶æ€
    if passwd -S $username | grep -q "Locked"; then
        echo "âš ï¸ è´¦å·è¢«é”å®š"
        echo "å»ºè®®: é‡ç½®å¯†ç æˆ–è”ç³»ç®¡ç†å‘˜è§£é”" >> /tmp/problem_$problem_id.txt
    fi

    # æ£€æŸ¥ç™»å½•å†å²
    echo "æœ€è¿‘ç™»å½•è®°å½•:" >> /tmp/problem_$problem_id.txt
    last -n 5 $username >> /tmp/problem_$problem_id.txt

    # æ£€æŸ¥é…é¢
    echo "ç£ç›˜é…é¢ä¿¡æ¯:" >> /tmp/problem_$problem_id.txt
    quota -u $username >> /tmp/problem_$problem_id.txt 2>/dev/null

    echo "è´¦å·è¯Šæ–­å®Œæˆ"
}

# 4. è½¯ä»¶é—®é¢˜è¯Šæ–­
diagnose_software_issue() {
    username=$1
    problem_id=$2

    echo "=== è½¯ä»¶é—®é¢˜è¯Šæ–­ ==="

    # æ£€æŸ¥æ¨¡å—ç¯å¢ƒ
    echo "å½“å‰æ¨¡å—ç¯å¢ƒ:" >> /tmp/problem_$problem_id.txt
    module list >> /tmp/problem_$problem_id.txt 2>&1

    # æ£€æŸ¥PATH
    echo "PATHç¯å¢ƒå˜é‡:" >> /tmp/problem_$problem_id.txt
    echo $PATH >> /tmp/problem_$problem_id.txt

    # æ£€æŸ¥å¸¸è§è½¯ä»¶
    echo "å¸¸ç”¨è½¯ä»¶çŠ¶æ€:" >> /tmp/problem_$problem_id.txt

    software_list=("python" "gcc" "mpi" "openmp" "matlab")

    for software in "${software_list[@]}"; do
        if command -v $software &>/dev/null; then
            echo "$software: $(which $software)" >> /tmp/problem_$problem_id.txt
        else
            echo "$software: Not found" >> /tmp/problem_$problem_id.txt
        fi
    done

    # æ£€æŸ¥ä½œä¸šçŠ¶æ€
    echo "å½“å‰ä½œä¸šçŠ¶æ€:" >> /tmp/problem_$problem_id.txt
    squeue -u $username >> /tmp/problem_$problem_id.txt 2>&1

    echo "è½¯ä»¶è¯Šæ–­å®Œæˆ"
}

# 5. ç¡¬ä»¶é—®é¢˜è¯Šæ–­
diagnose_hardware_issue() {
    username=$1
    problem_id=$2

    echo "=== ç¡¬ä»¶é—®é¢˜è¯Šæ–­ ==="

    # æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€
    echo "é›†ç¾¤èŠ‚ç‚¹çŠ¶æ€:" >> /tmp/problem_$problem_id.txt
    scontrol show nodes >> /tmp/problem_$problem_id.txt

    # æ£€æŸ¥ç”¨æˆ·ä½œä¸šä½¿ç”¨çš„èŠ‚ç‚¹
    echo "ç”¨æˆ·ä½œä¸šä½¿ç”¨çš„èŠ‚ç‚¹:" >> /tmp/problem_$problem_id.txt
    squeue -u $username -o "%N" | grep -v "NODELIST" >> /tmp/problem_$problem_id.txt

    # æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—
    echo "æœ€è¿‘çš„ç³»ç»Ÿé”™è¯¯:" >> /tmp/problem_$problem_id.txt
    grep -i "error\|fail\|critical" /var/log/messages | tail -10 >> /tmp/problem_$problem_id.txt

    # æ£€æŸ¥ç¡¬ä»¶é”™è¯¯
    echo "ç¡¬ä»¶é”™è¯¯ä¿¡æ¯:" >> /tmp/problem_$problem_id.txt
    if [ -f /var/log/mcelog ]; then
        tail -20 /var/log/mcelog >> /tmp/problem_$problem_id.txt
    fi

    echo "ç¡¬ä»¶è¯Šæ–­å®Œæˆ"
}

# 6. æ€§èƒ½é—®é¢˜è¯Šæ–­
diagnose_performance_issue() {
    username=$1
    problem_id=$2

    echo "=== æ€§èƒ½é—®é¢˜è¯Šæ–­ ==="

    # æ£€æŸ¥ç”¨æˆ·ä½œä¸šæ€§èƒ½
    echo "ç”¨æˆ·ä½œä¸šæ€§èƒ½ç»Ÿè®¡:" >> /tmp/problem_$problem_id.txt
    squeue -u $username -o "%j %T %M %C %l" >> /tmp/problem_$problem_id.txt

    # æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½
    echo "ç³»ç»Ÿè´Ÿè½½çŠ¶æ€:" >> /tmp/problem_$problem_id.txt
    uptime >> /tmp/problem_$problem_id.txt
    top -bn1 | head -10 >> /tmp/problem_$problem_id.txt

    # æ£€æŸ¥å†…å­˜ä½¿ç”¨
    echo "å†…å­˜ä½¿ç”¨æƒ…å†µ:" >> /tmp/problem_$problem_id.txt
    free -h >> /tmp/problem_$problem_id.txt

    # æ£€æŸ¥I/Oæ€§èƒ½
    echo "I/Oæ€§èƒ½ç»Ÿè®¡:" >> /tmp/problem_$problem_id.txt
    iostat -x 1 1 >> /tmp/problem_$problem_id.txt

    # æ£€æŸ¥ç½‘ç»œæ€§èƒ½
    echo "ç½‘ç»œè¿æ¥çŠ¶æ€:" >> /tmp/problem_$problem_id.txt
    netstat -i >> /tmp/problem_$problem_id.txt

    echo "æ€§èƒ½è¯Šæ–­å®Œæˆ"
}

# 7. ç½‘ç»œé—®é¢˜è¯Šæ–­
diagnose_network_issue() {
    username=$1
    problem_id=$2

    echo "=== ç½‘ç»œé—®é¢˜è¯Šæ–­ ==="

    # æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
    echo "ç½‘ç»œè¿é€šæ€§æµ‹è¯•:" >> /tmp/problem_$problem_id.txt

    target_hosts=("8.8.8.8" "1.1.1.1" "cluster-gateway")

    for host in "${target_hosts[@]}"; do
        if ping -c 1 -W 1 $host &>/dev/null; then
            echo "$host: OK" >> /tmp/problem_$problem_id.txt
        else
            echo "$host: FAILED" >> /tmp/problem_$problem_id.txt
        fi
    done

    # æ£€æŸ¥DNSè§£æ
    echo "DNSè§£ææµ‹è¯•:" >> /tmp/problem_$problem_id.txt
    nslookup google.com >> /tmp/problem_$problem_id.txt 2>&1

    # æ£€æŸ¥ç½‘ç»œæ¥å£
    echo "ç½‘ç»œæ¥å£çŠ¶æ€:" >> /tmp/problem_$problem_id.txt
    ip addr show >> /tmp/problem_$problem_id.txt

    # æ£€æŸ¥è·¯ç”±è¡¨
    echo "è·¯ç”±è¡¨ä¿¡æ¯:" >> /tmp/problem_$problem_id.txt
    ip route show >> /tmp/problem_$problem_id.txt

    echo "ç½‘ç»œè¯Šæ–­å®Œæˆ"
}

# 8. ç”Ÿæˆè¯Šæ–­æŠ¥å‘Š
generate_diagnostic_report() {
    problem_id=$1

    echo ""
    echo "=== è¯Šæ–­æŠ¥å‘Š ==="
    echo "é—®é¢˜ID: $problem_id"
    echo "è¯Šæ–­æ—¶é—´: $(date)"
    echo ""

    if [ -f /tmp/problem_$problem_id.txt ]; then
        echo "è¯Šæ–­ç»“æœæ‘˜è¦:"
        grep -E "å»ºè®®|æ¨è|é—®é¢˜|é”™è¯¯" /tmp/problem_$problem_id.txt | head -10
        echo ""

        echo "å®Œæ•´è¯Šæ–­æŠ¥å‘Šä¿å­˜åœ¨: /tmp/problem_$problem_id.txt"
    else
        echo "æœªæ‰¾åˆ°è¯Šæ–­æŠ¥å‘Š"
    fi
}

# 9. ä¸»è¯Šæ–­æµç¨‹
main_diagnosis() {
    echo "å¼€å§‹é—®é¢˜è¯Šæ–­æµç¨‹..."

    # æ”¶é›†é—®é¢˜ä¿¡æ¯
    collect_problem_info

    # è·å–é—®é¢˜ID
    problem_id=$(grep "Problem ID:" /tmp/problem_$problem_id.txt | cut -d: -f2 | tr -d ' ')

    # åˆæ­¥è¯Šæ–­
    initial_diagnosis $problem_id

    # ç”Ÿæˆè¯Šæ–­æŠ¥å‘Š
    generate_diagnostic_report $problem_id

    echo ""
    echo "è¯Šæ–­æµç¨‹å®Œæˆ"
    echo "è¯·å°†é—®é¢˜ID $problem_id æä¾›ç»™æŠ€æœ¯æ”¯æŒäººå‘˜"
}

# è¿è¡Œè¯Šæ–­æµç¨‹
main_diagnosis
```

#### 16.3.2 è¯Šæ–­å·¥å…·é›†

**ä¸“ä¸šè¯Šæ–­å·¥å…·è„šæœ¬ï¼š**

```bash
#!/bin/bash
# /opt/support/troubleshooting/professional_tools.sh

echo "=== Professional Diagnostic Tools ==="

# 1. é«˜çº§æ€§èƒ½åˆ†æå·¥å…·
advanced_performance_analysis() {
    echo "=== Advanced Performance Analysis ==="

    # CPUæ€§èƒ½åˆ†æ
    echo "1. CPU Performance Analysis"
    echo "CPUä½¿ç”¨ç‡ç»Ÿè®¡:"
    top -bn1 | grep "Cpu(s)"

    echo ""
    echo "CPUç¼“å­˜å‘½ä¸­ç‡:"
    perf stat -e cache-references,cache-misses,cycles,instructions sleep 10

    echo ""
    echo "CPUè´Ÿè½½åˆ†æ:"
    vmstat 1 5

    # å†…å­˜æ€§èƒ½åˆ†æ
    echo ""
    echo "2. Memory Performance Analysis"
    echo "å†…å­˜ä½¿ç”¨åˆ†å¸ƒ:"
    cat /proc/meminfo | grep -E "MemTotal|MemFree|MemAvailable|Buffers|Cached|SwapTotal|SwapFree"

    echo ""
    echo "å†…å­˜è®¿é—®æ¨¡å¼:"
    perf record -e mem-loads,mem-stores sleep 10
    perf report --stdio | head -20

    # I/Oæ€§èƒ½åˆ†æ
    echo ""
    echo "3. I/O Performance Analysis"
    echo "ç£ç›˜I/Oç»Ÿè®¡:"
    iostat -x 1 5

    echo ""
    echo "I/Oå»¶è¿Ÿåˆ†æ:"
    ioping -c 10 .

    # ç½‘ç»œæ€§èƒ½åˆ†æ
    echo ""
    echo "4. Network Performance Analysis"
    echo "ç½‘ç»œå¸¦å®½æµ‹è¯•:"
    iperf3 -c 8.8.8.8 -t 30 -f M &

    echo ""
    echo "ç½‘ç»œå»¶è¿Ÿæµ‹è¯•:"
    ping -c 10 8.8.8.8

    wait
}

# 2. å¹¶è¡Œä½œä¸šè¯Šæ–­å·¥å…·
mpi_job_diagnosis() {
    echo ""
    echo "=== MPI Job Diagnosis ==="

    # è·å–MPIä½œä¸šä¿¡æ¯
    echo "1. MPI Job Information"
    squeue -u $(whoami) -o "%j %T %M %C %l %N" | grep -v "JOBID"

    # MPIä½œä¸šæ€§èƒ½åˆ†æ
    echo ""
    echo "2. MPI Performance Analysis"
    if command -v mpirun &> /dev/null; then
        # ä½¿ç”¨Intel VTuneè¿›è¡ŒMPIåˆ†æï¼ˆå¦‚æœå¯ç”¨ï¼‰
        if command -v vtune &> /dev/null; then
            echo "ä½¿ç”¨VTuneè¿›è¡ŒMPIæ€§èƒ½åˆ†æ..."
            vtune -collect hotspots mpirun -np 4 ./test_mpi_program
        fi

        # ä½¿ç”¨TAUè¿›è¡ŒMPIåˆ†æ
        if command -v tau_exec &> /dev/null; then
            echo "ä½¿ç”¨TAUè¿›è¡ŒMPIåˆ†æ..."
            tau_exec -ebs mpirun -np 4 ./test_mpi_program
        fi
    fi

    # MPIé€šä¿¡åˆ†æ
    echo ""
    echo "3. MPI Communication Analysis"
    # æ£€æŸ¥MPIè¿›ç¨‹é—´é€šä¿¡
    echo "MPIè¿›ç¨‹åˆ—è¡¨:"
    ps aux | grep mpi

    # æ£€æŸ¥MPIåº“ç‰ˆæœ¬
    echo ""
    echo "MPIåº“ç‰ˆæœ¬ä¿¡æ¯:"
    mpicc --showme
    mpirun --version
}

# 3. å­˜å‚¨ç³»ç»Ÿè¯Šæ–­å·¥å…·
storage_diagnosis() {
    echo ""
    echo "=== Storage System Diagnosis ==="

    # æ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥
    echo "1. Filesystem Analysis"
    echo "æŒ‚è½½ç‚¹ä¿¡æ¯:"
    mount | grep -E "lustre|gpfs|nfs|ext4|xfs"

    echo ""
    echo "æ–‡ä»¶ç³»ç»ŸçŠ¶æ€:"
    df -h

    # LUSTREç‰¹å®šè¯Šæ–­
    if mount | grep -q lustre; then
        echo ""
        echo "2. LUSTRE Filesystem Diagnosis"
        echo "LUSTREæœåŠ¡å™¨çŠ¶æ€:"
        lfs check servers

        echo ""
        echo "LUSTREå®¢æˆ·ç«¯çŠ¶æ€:"
        lctl get_param osc.*.stats

        echo ""
        echo "LUSTREæ¡å¸¦åŒ–ä¿¡æ¯:"
        lfs getstripe /scratch

        echo ""
        echo "LUSTRE I/Oç»Ÿè®¡:"
        lctl get_param osc.*.stats | grep -E "read_bytes|write_bytes|rpcs_sent"
    fi

    # GPFSç‰¹å®šè¯Šæ–­
    if mount | grep -q gpfs; then
        echo ""
        echo "3. GPFS Filesystem Diagnosis"
        echo "GPFSé›†ç¾¤çŠ¶æ€:"
        mmlscluster

        echo ""
        echo "GPFSæ–‡ä»¶ç³»ç»ŸçŠ¶æ€:"
        mmlsfs all

        echo ""
        echo "GPFSèŠ‚ç‚¹çŠ¶æ€:"
        mmlsnode
    fi

    # å­˜å‚¨æ€§èƒ½æµ‹è¯•
    echo ""
    echo "4. Storage Performance Test"
    if command -v fio &> /dev/null; then
        echo "ä½¿ç”¨FIOè¿›è¡Œå­˜å‚¨æ€§èƒ½æµ‹è¯•..."
        fio --name=storage_test --filename=/tmp/fio_test --size=1G --bs=4k --numjobs=4 --runtime=60 --time_based --group_reporting
    fi
}

# 4. ç½‘ç»œäº’è¿è¯Šæ–­å·¥å…·
infiniband_diagnosis() {
    echo ""
    echo "=== InfiniBand Diagnosis ==="

    # InfiniBandçŠ¶æ€æ£€æŸ¥
    if command -v ibstat &> /dev/null; then
        echo "1. InfiniBand Interface Status"
        ibstat

        echo ""
        echo "2. InfiniBand Port Status"
        ibstat -l

        # å­ç½‘ç®¡ç†å™¨æ£€æŸ¥
        echo ""
        echo "3. Subnet Manager Status"
        smpquery -D

        # ç«¯å£ç»Ÿè®¡ä¿¡æ¯
        echo ""
        echo "4. Port Statistics"
        perfquery -a

        # InfiniBandæ€§èƒ½æµ‹è¯•
        echo ""
        echo "5. InfiniBand Performance Test"
        if command -v ib_send_bw &> /dev/null; then
            echo "InfiniBandå¸¦å®½æµ‹è¯•..."
            # éœ€è¦åœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šåˆ†åˆ«è¿è¡Œ
            echo "æœåŠ¡å™¨ç«¯: ib_send_bw -a"
            echo "å®¢æˆ·ç«¯: ib_send_bw <server_ip>"
        fi
    else
        echo "InfiniBandå·¥å…·æœªå®‰è£…"
    fi
}

# 5. ä½œä¸šè°ƒåº¦ç³»ç»Ÿè¯Šæ–­
slurm_diagnosis() {
    echo ""
    echo "=== SLURM Job Scheduler Diagnosis ==="

    # SLURMå®ˆæŠ¤è¿›ç¨‹çŠ¶æ€
    echo "1. SLURM Daemon Status"
    systemctl status slurmctld
    systemctl status slurmd

    # SLURMé…ç½®æ£€æŸ¥
    echo ""
    echo "2. SLURM Configuration"
    echo "SLURMé…ç½®æ–‡ä»¶æ£€æŸ¥:"
    ls -la /etc/slurm/*.conf

    echo ""
    echo "SLURMåˆ†åŒºä¿¡æ¯:"
    scontrol show partitions

    echo ""
    echo "SLURMèŠ‚ç‚¹ä¿¡æ¯:"
    scontrol show nodes | head -20

    # SLURMä½œä¸šåˆ†æ
    echo ""
    echo "3. SLURM Job Analysis"
    echo "å½“å‰ä½œä¸šé˜Ÿåˆ—:"
    squeue -h -o "%.18i %.9P %.8j %.8u %.2t %.10M %.6D %.14R"

    echo ""
    echo "æœ€è¿‘å®Œæˆçš„ä½œä¸š:"
    sacct -X -S $(date -d '1 hour ago' '+%Y-%m-%d %H:%M:%S') --format=JobID,JobName,State,Elapsed,TotalCPU,MaxRSS,NodeList

    # SLURMæ€§èƒ½ç»Ÿè®¡
    echo ""
    echo "4. SLURM Performance Statistics"
    echo "SLURMç»Ÿè®¡ä¿¡æ¯:"
    sstat -j $(squeue -h -t RUNNING -o "%i" | head -1) --format=JobID,MaxRSS,MaxVMSize,AveRSS,AveVMSize 2>/dev/null || echo "æ— æ³•è·å–ä½œä¸šç»Ÿè®¡ä¿¡æ¯"

    # SLURMæ—¥å¿—åˆ†æ
    echo ""
    echo "5. SLURM Log Analysis"
    echo "SLURMæ—¥å¿—æœ€è¿‘é”™è¯¯:"
    tail -50 /var/log/slurm/slurmctld.log | grep -i error
}

# 6. ç³»ç»Ÿèµ„æºè¯Šæ–­
resource_diagnosis() {
    echo ""
    echo "=== System Resource Diagnosis ==="

    # CPUèµ„æºè¯Šæ–­
    echo "1. CPU Resource Analysis"
    echo "CPUæ‹“æ‰‘ç»“æ„:"
    lscpu | grep -E "Socket|Core|Thread|NUMA"

    echo ""
    echo "CPUä½¿ç”¨æƒ…å†µ:"
    mpstat -P ALL 1 1

    # å†…å­˜èµ„æºè¯Šæ–­
    echo ""
    echo "2. Memory Resource Analysis"
    echo "NUMAæ‹“æ‰‘:"
    numactl --hardware

    echo ""
    echo "å†…å­˜ä½¿ç”¨ç»Ÿè®¡:"
    numastat

    # ç½‘ç»œèµ„æºè¯Šæ–­
    echo ""
    echo "3. Network Resource Analysis"
    echo "ç½‘ç»œæ¥å£ç»Ÿè®¡:"
    cat /proc/net/dev

    echo ""
    echo "ç½‘ç»œè¿æ¥ç»Ÿè®¡:"
    ss -tuln | wc -l

    # å­˜å‚¨èµ„æºè¯Šæ–­
    echo ""
    echo "4. Storage Resource Analysis"
    echo "ç£ç›˜I/Oç»Ÿè®¡:"
    iostat -x | grep -E "Device|sd|nvme"

    echo ""
    echo "æ–‡ä»¶ç³»ç»Ÿä½¿ç”¨æƒ…å†µ:"
    df -h
}

# 7. ç»¼åˆè¯Šæ–­æŠ¥å‘Š
comprehensive_diagnosis_report() {
    echo ""
    echo "=== Comprehensive System Diagnosis Report ==="
    echo "Generated: $(date)"
    echo "Hostname: $(hostname)"
    echo ""

    # ç³»ç»ŸåŸºæœ¬ä¿¡æ¯
    echo "System Information:"
    uname -a
    cat /etc/os-release | head -1
    echo ""

    # å¿«é€Ÿå¥åº·æ£€æŸ¥
    echo "Quick Health Check:"
    echo "- CPU Load: $(uptime | awk -F'load average:' '{print $2}')"
    echo "- Memory Usage: $(free | awk 'NR==2{printf "%.2f%%", $3*100/$2}')"
    echo "- Disk Usage: $(df / | awk 'NR==2{print $5}')"
    echo "- Uptime: $(uptime -p)"
    echo ""

    # æœåŠ¡çŠ¶æ€
    echo "Critical Services Status:"
    services=("slurmctld" "slurmd" "sshd" "named" "ntpd")

    for service in "${services[@]}"; do
        if systemctl is-active --quiet $service 2>/dev/null; then
            echo "âœ“ $service: Running"
        else
            echo "âœ— $service: Not running"
        fi
    done

    echo ""
    echo "Diagnostic report completed."
    echo "For detailed analysis, run specific diagnostic tools."
}

# ä¸»å‡½æ•°
main() {
    echo "HPC Cluster Professional Diagnostic Tools"
    echo "=========================================="
    echo ""

    # è¿è¡Œç»¼åˆè¯Šæ–­
    comprehensive_diagnosis_report

    # æ ¹æ®éœ€è¦è¿è¡Œç‰¹å®šè¯Šæ–­
    echo ""
    echo "Running advanced diagnostic tools..."
    advanced_performance_analysis
    mpi_job_diagnosis
    storage_diagnosis
    infiniband_diagnosis
    slurm_diagnosis
    resource_diagnosis

    echo ""
    echo "All diagnostic tools completed."
    echo "Please review the output for any issues or anomalies."
}

# è¿è¡Œä¸»å‡½æ•°
main
```

#### 16.3.3 é—®é¢˜è§£å†³çŸ¥è¯†åº“

**æ™ºèƒ½é—®é¢˜è§£å†³ç³»ç»Ÿï¼š**

```bash
#!/bin/bash
# /opt/support/troubleshooting/knowledge_base.sh

echo "=== HPC Problem Solving Knowledge Base ==="

# 1. å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆåº“
common_solutions_db() {
    cat > /opt/support/troubleshooting/solutions.json << 'EOF'
{
  "account_issues": {
    "password_reset": {
      "symptoms": ["Cannot login", "Authentication failed", "Password expired"],
      "diagnosis": "Check if user can login, verify password expiration",
      "solution": "Reset password using passwd command or web portal",
      "command": "passwd username",
      "prevention": "Set password expiration reminders"
    },
    "account_locked": {
      "symptoms": ["Account locked", "Too many failed login attempts"],
      "diagnosis": "Check /var/log/secure for failed login attempts",
      "solution": "Unlock account using usermod command",
      "command": "usermod -U username",
      "prevention": "Implement MFA and secure password policies"
    }
  },
  "software_issues": {
    "module_not_found": {
      "symptoms": ["Command not found", "Module load failed"],
      "diagnosis": "Check module availability and PATH",
      "solution": "Load correct module or install software",
      "command": "module load software_name",
      "prevention": "Document software requirements"
    },
    "compilation_error": {
      "symptoms": ["Compilation failed", "Missing libraries", "Link errors"],
      "diagnosis": "Check compiler version and library paths",
      "solution": "Install missing dependencies or update compiler",
      "command": "module load compiler_name",
      "prevention": "Use standardized build environments"
    }
  },
  "performance_issues": {
    "slow_job": {
      "symptoms": ["Job running slowly", "High CPU usage", "Memory issues"],
      "diagnosis": "Profile job performance and resource usage",
      "solution": "Optimize code, adjust resource allocation",
      "command": "perf record -g ./job_script",
      "prevention": "Performance testing and optimization"
    },
    "high_memory_usage": {
      "symptoms": ["Out of memory", "Job killed", "Swapping"],
      "diagnosis": "Check memory allocation and usage patterns",
      "solution": "Optimize memory usage, increase allocation",
      "command": "sbatch --mem=8G job.sh",
      "prevention": "Memory profiling and optimization"
    }
  },
  "network_issues": {
    "connection_failed": {
      "symptoms": ["Cannot connect to cluster", "SSH timeout", "Network unreachable"],
      "diagnosis": "Check network connectivity and firewall rules",
      "solution": "Verify network settings, check firewall",
      "command": "ping hostname",
      "prevention": "Network monitoring and documentation"
    },
    "slow_transfer": {
      "symptoms": ["Slow file transfer", "High latency", "Low bandwidth"],
      "diagnosis": "Test network performance and check bottlenecks",
      "solution": "Optimize transfer methods, check network hardware",
      "command": "scp -C file user@host:/path",
      "prevention": "Network optimization and monitoring"
    }
  }
}
EOF
}

# 2. æ™ºèƒ½é—®é¢˜åŒ¹é…å¼•æ“
problem_matching_engine() {
    echo "=== Problem Matching Engine ==="

    # ç”¨æˆ·è¾“å…¥é—®é¢˜æè¿°
    echo "è¯·è¾“å…¥æ‚¨çš„é—®é¢˜æè¿°:"
    read -r problem_description

    # è½¬æ¢ä¸ºå°å†™å¹¶åˆ†è¯
    problem_lower=$(echo "$problem_description" | tr '[:upper:]' '[:lower:]')
    words=($problem_lower)

    # åŒ¹é…ç—‡çŠ¶
    matches=()

    for word in "${words[@]}"; do
        case $word in
            "cannot"|"can't"|"cant")
                matches+=("login_failed" "connection_failed")
                ;;
            "password"|"passwd")
                matches+=("password_reset")
                ;;
            "slow"|"slowly"|"performance")
                matches+=("slow_job" "high_memory_usage")
                ;;
            "memory"|"out of memory"|"oom")
                matches+=("high_memory_usage")
                ;;
            "module"|"command not found")
                matches+=("module_not_found")
                ;;
            "compilation"|"compile"|"make")
                matches+=("compilation_error")
                ;;
            "network"|"connect"|"ssh")
                matches+=("connection_failed")
                ;;
            "transfer"|"scp"|"rsync")
                matches+=("slow_transfer")
                ;;
        esac
    done

    # å»é‡
    unique_matches=($(printf '%s\n' "${matches[@]}" | sort -u))

    # æ˜¾ç¤ºåŒ¹é…ç»“æœ
    if [ ${#unique_matches[@]} -eq 0 ]; then
        echo "æœªæ‰¾åˆ°åŒ¹é…çš„é—®é¢˜ç±»å‹"
        echo "è¯·å°è¯•æ›´å…·ä½“çš„æè¿°æˆ–è”ç³»æŠ€æœ¯æ”¯æŒ"
        return 1
    fi

    echo ""
    echo "åŒ¹é…åˆ°çš„é—®é¢˜ç±»å‹:"
    for match in "${unique_matches[@]}"; do
        echo "- $match"
    done

    # æä¾›è§£å†³æ–¹æ¡ˆ
    provide_solutions "${unique_matches[@]}"
}

# 3. è§£å†³æ–¹æ¡ˆæä¾›å™¨
provide_solutions() {
    echo ""
    echo "=== Recommended Solutions ==="

    for problem_type in "$@"; do
        echo ""
        echo "Problem Type: $problem_type"
        echo "--------------------------------"

        case $problem_type in
            "password_reset")
                echo "Symptoms: Cannot login, authentication failed"
                echo "Solution: Reset your password"
                echo "Command: passwd"
                echo "Prevention: Use strong passwords and enable MFA"
                ;;
            "connection_failed")
                echo "Symptoms: Cannot connect to cluster, SSH timeout"
                echo "Solution: Check network connectivity"
                echo "Command: ping hostname"
                echo "Prevention: Verify network settings"
                ;;
            "slow_job")
                echo "Symptoms: Job running slowly, high CPU usage"
                echo "Solution: Optimize code and resource allocation"
                echo "Command: perf record -g ./job_script"
                echo "Prevention: Performance testing and profiling"
                ;;
            "module_not_found")
                echo "Symptoms: Command not found, module load failed"
                echo "Solution: Load correct module"
                echo "Command: module load software_name"
                echo "Prevention: Document software requirements"
                ;;
            "compilation_error")
                echo "Symptoms: Compilation failed, missing libraries"
                echo "Solution: Install dependencies"
                echo "Command: module load compiler_name"
                echo "Prevention: Standardized build environments"
                ;;
            *)
                echo "Solution not found in database"
                echo "Please contact technical support"
                ;;
        esac
    done
}

# 4. è‡ªåŠ¨ä¿®å¤è„šæœ¬
automatic_fixes() {
    echo ""
    echo "=== Automatic Fixes ==="

    read -p "æ˜¯å¦å°è¯•è‡ªåŠ¨ä¿®å¤? (y/n): " auto_fix

    if [[ $auto_fix =~ ^[Yy]$ ]]; then
        echo "å¼€å§‹è‡ªåŠ¨ä¿®å¤..."

        # å¯†ç é‡ç½®è‡ªåŠ¨ä¿®å¤
        read -p "è¯·è¾“å…¥ç”¨æˆ·å: " username
        if id $username &>/dev/null; then
            echo "é‡ç½®ç”¨æˆ· $username çš„å¯†ç ..."
            passwd $username
            echo "å¯†ç é‡ç½®å®Œæˆ"
        else
            echo "ç”¨æˆ·ä¸å­˜åœ¨ï¼Œè·³è¿‡å¯†ç é‡ç½®"
        fi

        # æ¨¡å—åŠ è½½è‡ªåŠ¨ä¿®å¤
        echo "æ£€æŸ¥å¹¶ä¿®å¤æ¨¡å—ç¯å¢ƒ..."
        module purge
        module load gcc
        module load openmpi
        echo "æ¨¡å—ç¯å¢ƒå·²ä¿®å¤"

        # ç½‘ç»œè¿æ¥è‡ªåŠ¨ä¿®å¤
        echo "æ£€æŸ¥ç½‘ç»œè¿æ¥..."
        if ! ping -c 1 -W 1 cluster-gateway &>/dev/null; then
            echo "ç½‘ç»œè¿æ¥å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®"
        else
            echo "ç½‘ç»œè¿æ¥æ­£å¸¸"
        fi

        echo "è‡ªåŠ¨ä¿®å¤å®Œæˆ"
    else
        echo "è·³è¿‡è‡ªåŠ¨ä¿®å¤"
    fi
}

# 5. é—®é¢˜è®°å½•å’Œåé¦ˆ
problem_logging() {
    echo ""
    echo "=== Problem Logging ==="

    # è®°å½•é—®é¢˜
    problem_id="LOG_$(date +%Y%m%d_%H%M%S)"
    log_file="/var/log/hpc_support/$problem_id.log"

    mkdir -p /var/log/hpc_support

    echo "Problem ID: $problem_id" > $log_file
    echo "Timestamp: $(date)" >> $log_file
    echo "Description: $problem_description" >> $log_file
    echo "Solution: $solution_applied" >> $log_file
    echo "Status: Resolved" >> $log_file

    echo "é—®é¢˜å·²è®°å½•: $log_file"
}

# 6. ä¸»äº¤äº’ç•Œé¢
main_interface() {
    while true; do
        echo ""
        echo "HPC Support Knowledge Base"
        echo "=========================="
        echo "1. é—®é¢˜è¯Šæ–­å’Œè§£å†³"
        echo "2. æŸ¥çœ‹å¸¸è§é—®é¢˜"
        echo "3. è”ç³»æŠ€æœ¯æ”¯æŒ"
        echo "4. é€€å‡º"
        echo ""

        read -p "è¯·é€‰æ‹©æ“ä½œ (1-4): " choice

        case $choice in
            1)
                problem_matching_engine
                automatic_fixes
                problem_logging
                ;;
            2)
                echo ""
                echo "å¸¸è§é—®é¢˜åˆ—è¡¨:"
                echo "- å¯†ç é‡ç½®"
                echo "- æ¨¡å—åŠ è½½å¤±è´¥"
                echo "- ä½œä¸šè¿è¡Œç¼“æ…¢"
                echo "- ç½‘ç»œè¿æ¥é—®é¢˜"
                echo "- ç¼–è¯‘é”™è¯¯"
                ;;
            3)
                echo ""
                echo "æŠ€æœ¯æ”¯æŒè”ç³»æ–¹å¼:"
                echo "ç”µè¯: 400-xxx-xxxx"
                echo "é‚®ç®±: support@hpc.example.com"
                echo "å·¥å•ç³»ç»Ÿ: https://support.hpc.example.com"
                ;;
            4)
                echo "æ„Ÿè°¢ä½¿ç”¨HPCæ”¯æŒç³»ç»Ÿ"
                break
                ;;
            *)
                echo "æ— æ•ˆé€‰æ‹©ï¼Œè¯·é‡æ–°è¾“å…¥"
                ;;
        esac
    done
}

# åˆå§‹åŒ–çŸ¥è¯†åº“
common_solutions_db

# è¿è¡Œä¸»ç•Œé¢
main_interface
```

### 16.4 æœåŠ¡çº§åˆ«ç®¡ç†

#### 16.4.1 æœåŠ¡ç›‘æ§å’ŒæŠ¥å‘Š

**æœåŠ¡ç›‘æ§è‡ªåŠ¨åŒ–ç³»ç»Ÿï¼š**

```bash
#!/bin/bash
# /opt/support/slm/service_monitoring.sh

echo "=== Service Level Management Monitoring ==="

# 1. æœåŠ¡å¯ç”¨æ€§ç›‘æ§
service_availability_monitor() {
    echo "1. Service Availability Monitoring"

    # å®šä¹‰å…³é”®æœåŠ¡
    critical_services=(
        "slurmctld:SLURM Controller"
        "slurmd:SLURM Daemon"
        "sshd:SSH Service"
        "named:DNS Service"
        "ntpd:NTP Service"
        "httpd:Web Service"
    )

    availability_data=()
    downtime_data=()

    for service_info in "${critical_services[@]}"; do
        IFS=':' read -r service_name service_desc <<< "$service_info"

        # æ£€æŸ¥æœåŠ¡çŠ¶æ€
        if systemctl is-active --quiet $service_name 2>/dev/null; then
            status="UP"
            uptime=$(systemctl show $service_name --property=ActiveEnterTimestamp | cut -d= -f2)
        else
            status="DOWN"
            downtime=$(date '+%Y-%m-%d %H:%M:%S')
        fi

        # è®°å½•æœåŠ¡çŠ¶æ€
        echo "$(date '+%Y-%m-%d %H:%M:%S'),$service_name,$service_desc,$status,$uptime,$downtime" >> /var/log/service_availability.log

        if [ "$status" = "UP" ]; then
            availability_data+=("$service_name:OK")
        else
            availability_data+=("$service_name:DOWN")
            downtime_data+=("$service_name:$downtime")
        fi
    done

    # è®¡ç®—æ•´ä½“å¯ç”¨æ€§
    total_services=${#critical_services[@]}
    up_services=$(echo "${availability_data[@]}" | grep -c "OK")
    availability_percentage=$((up_services * 100 / total_services))

    echo "Overall Service Availability: $availability_percentage%"
    echo "Available Services: $up_services/$total_services"

    return $availability_percentage
}

# 2. æ€§èƒ½æŒ‡æ ‡ç›‘æ§
performance_metrics_monitor() {
    echo ""
    echo "2. Performance Metrics Monitoring"

    # CPUæ€§èƒ½æŒ‡æ ‡
    cpu_usage=$(top -bn1 | grep "Cpu(s)" | awk '{print 100 - $8}' | sed 's/%id,//')
    cpu_load=$(uptime | awk -F'load average:' '{print $2}' | awk '{print $1}' | sed 's/,//')

    # å†…å­˜æ€§èƒ½æŒ‡æ ‡
    memory_usage=$(free | awk 'NR==2{printf "%.2f", $3*100/$2}')
    swap_usage=$(free | awk 'NR==3{printf "%.2f", $3*100/$2}')

    # å­˜å‚¨æ€§èƒ½æŒ‡æ ‡
    disk_usage=$(df / | awk 'NR==2{print $5}' | sed 's/%//')
    disk_iops=$(iostat -d 1 1 | grep -E "Device|sd|nvme" | tail -1 | awk '{print $4}')

    # ç½‘ç»œæ€§èƒ½æŒ‡æ ‡
    network_errors=$(cat /proc/net/dev | awk 'NR>2 {print $2+$10}' | head -1)
    network_packets=$(cat /proc/net/dev | awk 'NR>2 {print $1+$9}' | head -1)

    # è®°å½•æ€§èƒ½æŒ‡æ ‡
    echo "$(date '+%Y-%m-%d %H:%M:%S'),$cpu_usage,$cpu_load,$memory_usage,$swap_usage,$disk_usage,$disk_iops,$network_errors,$network_packets" >> /var/log/performance_metrics.log

    # ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š
    echo "CPU Usage: $cpu_usage%"
    echo "CPU Load: $cpu_load"
    echo "Memory Usage: $memory_usage%"
    echo "Swap Usage: $swap_usage%"
    echo "Disk Usage: $disk_usage%"
    echo "Disk IOPS: $disk_iops"
    echo "Network Errors: $network_errors"
    echo "Network Packets: $network_packets"

    # æ£€æŸ¥æ€§èƒ½é˜ˆå€¼
    check_performance_thresholds "$cpu_usage" "$memory_usage" "$disk_usage"
}

# 3. æ€§èƒ½é˜ˆå€¼æ£€æŸ¥
check_performance_thresholds() {
    cpu_usage=$1
    memory_usage=$2
    disk_usage=$3

    echo ""
    echo "3. Performance Threshold Check"

    # å®šä¹‰é˜ˆå€¼
    CPU_THRESHOLD=80
    MEMORY_THRESHOLD=90
    DISK_THRESHOLD=85

    # æ£€æŸ¥CPUé˜ˆå€¼
    if (( $(echo "$cpu_usage > $CPU_THRESHOLD" | bc -l) )); then
        echo "âš ï¸  CPU usage exceeds threshold: $cpu_usage% > $CPU_THRESHOLD%"
        send_alert "CPU" "$cpu_usage%" "High CPU usage detected"
    fi

    # æ£€æŸ¥å†…å­˜é˜ˆå€¼
    if (( $(echo "$memory_usage > $MEMORY_THRESHOLD" | bc -l) )); then
        echo "âš ï¸  Memory usage exceeds threshold: $memory_usage% > $MEMORY_THRESHOLD%"
        send_alert "Memory" "$memory_usage%" "High memory usage detected"
    fi

    # æ£€æŸ¥ç£ç›˜é˜ˆå€¼
    if [ "$disk_usage" -gt "$DISK_THRESHOLD" ]; then
        echo "âš ï¸  Disk usage exceeds threshold: $disk_usage% > $DISK_THRESHOLD%"
        send_alert "Disk" "$disk_usage%" "High disk usage detected"
    fi
}

# 4. ç”¨æˆ·æ»¡æ„åº¦ç›‘æ§
user_satisfaction_monitor() {
    echo ""
    echo "4. User Satisfaction Monitoring"

    # æ”¶é›†ç”¨æˆ·åé¦ˆ
    feedback_file="/var/log/user_feedback.log"

    if [ -f "$feedback_file" ]; then
        # è®¡ç®—å¹³å‡æ»¡æ„åº¦è¯„åˆ†
        avg_rating=$(awk -F',' '{sum+=$3; count++} END {print sum/count}' "$feedback_file")

        # ç»Ÿè®¡åé¦ˆæ•°é‡
        feedback_count=$(wc -l < "$feedback_file")

        echo "Average User Rating: $avg_rating/5.0"
        echo "Total Feedback Count: $feedback_count"

        # åˆ†æåé¦ˆè¶‹åŠ¿
        recent_feedback=$(tail -10 "$feedback_file")
        echo "Recent Feedback:"
        echo "$recent_feedback"

        return $avg_rating
    else
        echo "No user feedback available"
        return 0
    fi
}

# 5. SLAåˆè§„æ€§æ£€æŸ¥
sla_compliance_check() {
    echo ""
    echo "5. SLA Compliance Check"

    # è¯»å–SLAé…ç½®
    sla_config="/opt/support/sla/definitions.yaml"

    if [ -f "$sla_config" ]; then
        # æ£€æŸ¥å“åº”æ—¶é—´SLA
        response_compliance=$(calculate_sla_compliance "response_time")
        echo "Response Time SLA Compliance: $response_compliance%"

        # æ£€æŸ¥è§£å†³æ—¶é—´SLA
        resolution_compliance=$(calculate_sla_compliance "resolution_time")
        echo "Resolution Time SLA Compliance: $resolution_compliance%"

        # æ£€æŸ¥æœåŠ¡å¯ç”¨æ€§SLA
        availability_compliance=$(calculate_sla_compliance "availability")
        echo "Service Availability SLA Compliance: $availability_compliance%"

        # ç”ŸæˆSLAæŠ¥å‘Š
        generate_sla_compliance_report "$response_compliance" "$resolution_compliance" "$availability_compliance"
    else
        echo "SLA configuration not found"
    fi
}

# 6. SLAåˆè§„æ€§è®¡ç®—
calculate_sla_compliance() {
    metric_type=$1

    case $metric_type in
        "response_time")
            # ä»å·¥å•ç³»ç»Ÿè·å–å“åº”æ—¶é—´æ•°æ®
            total_tickets=$(grep -c "Ticket" /var/log/ticket_system.log)
            compliant_tickets=$(grep -c "Response Time Compliant" /var/log/ticket_system.log)
            if [ $total_tickets -gt 0 ]; then
                compliance=$((compliant_tickets * 100 / total_tickets))
            else
                compliance=100
            fi
            ;;
        "resolution_time")
            # ä»å·¥å•ç³»ç»Ÿè·å–è§£å†³æ—¶é—´æ•°æ®
            total_resolved=$(grep -c "Resolved" /var/log/ticket_system.log)
            compliant_resolutions=$(grep -c "Resolution Time Compliant" /var/log/ticket_system.log)
            if [ $total_resolved -gt 0 ]; then
                compliance=$((compliant_resolutions * 100 / total_resolved))
            else
                compliance=100
            fi
            ;;
        "availability")
            # ä»æœåŠ¡ç›‘æ§è·å–å¯ç”¨æ€§æ•°æ®
            total_checks=$(grep -c "Service Check" /var/log/service_availability.log)
            up_checks=$(grep -c "UP" /var/log/service_availability.log)
            if [ $total_checks -gt 0 ]; then
                compliance=$((up_checks * 100 / total_checks))
            else
                compliance=100
            fi
            ;;
    esac

    echo $compliance
}

# 7. å‘Šè­¦ç³»ç»Ÿ
send_alert() {
    alert_type=$1
    alert_value=$2
    alert_message=$3

    timestamp=$(date '+%Y-%m-%d %H:%M:%S')

    # è®°å½•å‘Šè­¦
    echo "$timestamp,$alert_type,$alert_value,$alert_message" >> /var/log/alarms.log

    # å‘é€é‚®ä»¶å‘Šè­¦
    echo "Alert: $alert_message ($alert_type: $alert_value)" | \
        mail -s "HPC Service Alert: $alert_type" support-team@hpc.example.com

    # å‘é€çŸ­ä¿¡å‘Šè­¦ï¼ˆå¦‚æœæœ‰çŸ­ä¿¡ç½‘å…³ï¼‰
    # echo "ALERT: $alert_message" | curl -X POST -d "to=1234567890" https://sms-gateway.example.com/send

    # å‘é€Slackå‘Šè­¦
    if command -v curl &> /dev/null; then
        curl -X POST -H 'Content-type: application/json' \
            --data "{\"text\":\"ğŸš¨ HPC Alert: $alert_message ($alert_type: $alert_value)\"}" \
            https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK
    fi

    echo "Alert sent: $alert_message"
}

# 8. æŠ¥å‘Šç”Ÿæˆ
generate_sla_compliance_report() {
    response_compliance=$1
    resolution_compliance=$2
    availability_compliance=$3

    report_file="/tmp/sla_compliance_report_$(date +%Y%m%d_%H%M%S).html"

    cat > $report_file << EOF
<!DOCTYPE html>
<html>
<head>
    <title>SLA Compliance Report</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .header { background-color: #f0f0f0; padding: 20px; border-radius: 5px; }
        .metric { display: inline-block; margin: 10px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; width: 200px; text-align: center; }
        .compliant { background-color: #d4edda; color: #155724; }
        .warning { background-color: #fff3cd; color: #856404; }
        .critical { background-color: #f8d7da; color: #721c24; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <div class="header">
        <h1>SLA Compliance Report</h1>
        <p>Generated: $(date)</p>
        <p>Hostname: $(hostname)</p>
    </div>

    <h2>Compliance Summary</h2>
    <div class="metrics">
        <div class="metric $(get_status_class $response_compliance)">
            <h3>Response Time SLA</h3>
            <p>$response_compliance%</p>
            <p>Target: 95%</p>
        </div>

        <div class="metric $(get_status_class $resolution_compliance)">
            <h3>Resolution Time SLA</h3>
            <p>$resolution_compliance%</p>
            <p>Target: 90%</p>
        </div>

        <div class="metric $(get_status_class $availability_compliance)">
            <h3>Service Availability SLA</h3>
            <p>$availability_compliance%</p>
            <p>Target: 99.5%</p>
        </div>
    </div>

    <h2>Detailed Metrics</h2>
    <table>
        <tr>
            <th>Metric</th>
            <th>Current Value</th>
            <th>Target Value</th>
            <th>Status</th>
            <th>Trend</th>
        </tr>
        <tr>
            <td>Response Time SLA</td>
            <td>$response_compliance%</td>
            <td>95%</td>
            <td>$(get_status_text $response_compliance)</td>
            <td>Stable</td>
        </tr>
        <tr>
            <td>Resolution Time SLA</td>
            <td>$resolution_compliance%</td>
            <td>90%</td>
            <td>$(get_status_text $resolution_compliance)</td>
            <td>Improving</td>
        </tr>
        <tr>
            <td>Service Availability SLA</td>
            <td>$availability_compliance%</td>
            <td>99.5%</td>
            <td>$(get_status_text $availability_compliance)</td>
            <td>Stable</td>
        </tr>
    </table>

    <h2>Recommendations</h2>
    <ul>
        $(generate_recommendations $response_compliance $resolution_compliance $availability_compliance)
    </ul>
</body>
</html>
EOF

    echo "SLA compliance report generated: $report_file"

    # å‘é€æŠ¥å‘Š
    mail -s "SLA Compliance Report - $(date +%Y-%m-%d)" support-manager@hpc.example.com < $report_file
}

# 9. è¾…åŠ©å‡½æ•°
get_status_class() {
    compliance=$1
    if [ $compliance -ge 95 ]; then
        echo "compliant"
    elif [ $compliance -ge 85 ]; then
        echo "warning"
    else
        echo "critical"
    fi
}

get_status_text() {
    compliance=$1
    if [ $compliance -ge 95 ]; then
        echo "Compliant"
    elif [ $compliance -ge 85 ]; then
        echo "Warning"
    else
        echo "Critical"
    fi
}

generate_recommendations() {
    response_compliance=$1
    resolution_compliance=$2
    availability_compliance=$3

    recommendations=""

    if [ $response_compliance -lt 95 ]; then
        recommendations="$recommendations<li>Consider increasing L1 support staff during peak hours</li>"
    fi

    if [ $resolution_compliance -lt 90 ]; then
        recommendations="$recommendations<li>Review L2/L3 escalation procedures and response times</li>"
    fi

    if [ $availability_compliance -lt 99.5 ]; then
        recommendations="$recommendations<li>Implement additional monitoring and redundancy measures</li>"
    fi

    if [ -z "$recommendations" ]; then
        recommendations="<li>All SLA metrics are within acceptable ranges</li>"
    fi

    echo "$recommendations"
}

# 10. ä¸»ç›‘æ§å¾ªç¯
main_monitoring_loop() {
    echo "Starting Service Level Management Monitoring..."

    while true; do
        echo ""
        echo "=== Monitoring Cycle: $(date) ==="

        # æ‰§è¡Œå„é¡¹ç›‘æ§
        service_availability_monitor
        performance_metrics_monitor
        user_satisfaction_monitor
        sla_compliance_check

        echo ""
        echo "Monitoring cycle completed. Waiting for next cycle..."

        # ç­‰å¾…30åˆ†é’Ÿ
        sleep 1800
    done
}

# è¿è¡Œä¸»ç›‘æ§å¾ªç¯
main_monitoring_loop
```

#### 16.4.2 æœåŠ¡æ”¹è¿›è®¡åˆ’

**æŒç»­æ”¹è¿›ç®¡ç†ç³»ç»Ÿï¼š**

```bash
#!/bin/bash
# /opt/support/slm/improvement_planning.sh

echo "=== Service Improvement Planning System ==="

# 1. é—®é¢˜åˆ†æå’Œæ ¹æœ¬åŸå› åˆ†æ
root_cause_analysis() {
    echo "1. Root Cause Analysis"

    # ä»æ—¥å¿—ä¸­æ”¶é›†é—®é¢˜æ•°æ®
    problem_data="/var/log/service_problems.log"
    sla_breaches="/var/log/sla_breaches.log"

    if [ -f "$problem_data" ]; then
        # åˆ†æé—®é¢˜æ¨¡å¼
        echo "Analyzing problem patterns..."

        # æŒ‰é—®é¢˜ç±»å‹ç»Ÿè®¡
        problem_types=$(awk -F',' '{print $3}' "$problem_data" | sort | uniq -c | sort -nr)
        echo "Problem Type Distribution:"
        echo "$problem_types"

        # æŒ‰æ—¶é—´åˆ†æ
        problem_trends=$(awk -F',' '{print $1}' "$problem_data" | cut -d' ' -f1 | sort | uniq -c)
        echo ""
        echo "Problem Trends by Date:"
        echo "$problem_trends"

        # è¯†åˆ«é«˜é¢‘é—®é¢˜
        high_frequency_problems=$(echo "$problem_types" | awk '$1 > 5 {print $2}')
        echo ""
        echo "High Frequency Problems:"
        echo "$high_frequency_problems"
    fi

    if [ -f "$sla_breaches" ]; then
        # åˆ†æSLAè¿è§„åŸå› 
        echo ""
        echo "SLA Breach Analysis:"
        awk -F',' '{print $3}' "$sla_breaches" | sort | uniq -c | sort -nr
    fi
}

# 2. æ”¹è¿›æœºä¼šè¯†åˆ«
opportunity_identification() {
    echo ""
    echo "2. Improvement Opportunities Identification"

    # æ€§èƒ½ç“¶é¢ˆåˆ†æ
    echo "Performance Bottleneck Analysis:"
    iostat -x 1 5 | grep -E "Device|sd|nvme" | awk '$9 > 80 {print "High latency detected on " $1 ": " $9 "ms"}'

    # èµ„æºåˆ©ç”¨ç‡åˆ†æ
    echo ""
    echo "Resource Utilization Analysis:"
    cpu_avg=$(top -bn10 | grep "Cpu(s)" | awk '{print 100-$8}' | awk '{sum+=$1; count++} END {print sum/count}')
    mem_avg=$(free | awk 'NR==2{printf "%.2f", $3*100/$2}')
    disk_avg=$(df / | awk 'NR==2{print $5}' | sed 's/%//')

    echo "Average CPU Usage: $cpu_avg%"
    echo "Average Memory Usage: $mem_avg%"
    echo "Current Disk Usage: $disk_avg%"

    # ç”¨æˆ·åé¦ˆåˆ†æ
    echo ""
    echo "User Feedback Analysis:"
    if [ -f "/var/log/user_feedback.log" ]; then
        avg_rating=$(awk -F',' '{sum+=$3; count++} END {print sum/count}' /var/log/user_feedback.log)
        echo "Average User Rating: $avg_rating/5.0"

        # åˆ†æè´Ÿé¢åé¦ˆ
        negative_feedback=$(awk -F',' '$3 < 3 {print $4}' /var/log/user_feedback.log)
        if [ ! -z "$negative_feedback" ]; then
            echo "Common Issues from User Feedback:"
            echo "$negative_feedback" | sort | uniq -c | sort -nr
        fi
    fi

    # ç«äº‰å¯¹æ‰‹åˆ†æï¼ˆå¦‚æœæœ‰åŸºå‡†æ•°æ®ï¼‰
    echo ""
    echo "Benchmarking Analysis:"
    # è¿™é‡Œå¯ä»¥é›†æˆå¤–éƒ¨åŸºå‡†æ•°æ®
    echo "Compare current performance with industry standards"
}

# 3. æ”¹è¿›é¡¹ç›®è§„åˆ’
improvement_project_planning() {
    echo ""
    echo "3. Improvement Project Planning"

    # åˆ›å»ºæ”¹è¿›é¡¹ç›®åˆ—è¡¨
    improvement_projects=()

    # åŸºäºåˆ†æç»“æœåˆ›å»ºé¡¹ç›®
    if [ $(echo "$cpu_avg > 80" | bc) -eq 1 ]; then
        improvement_projects+=("CPU_Optimization:High CPU usage optimization:High:30:Reduce average CPU usage to below 70%")
    fi

    if [ $(echo "$mem_avg > 85" | bc) -eq 1 ]; then
        improvement_projects+=("Memory_Optimization:Memory usage optimization:High:45:Reduce memory usage and implement better allocation")
    fi

    if [ $disk_avg -gt 80 ]; then
        improvement_projects+=("Storage_Optimization:Storage management improvement:Medium:60:Implement better storage management and cleanup")
    fi

    # è¾“å‡ºæ”¹è¿›é¡¹ç›®
    echo "Proposed Improvement Projects:"
    for project in "${improvement_projects[@]}"; do
        IFS=':' read -r project_id project_name priority duration goal <<< "$project"
        echo ""
        echo "Project: $project_name"
        echo "  ID: $project_id"
        echo "  Priority: $priority"
        echo "  Duration: $duration days"
        echo "  Goal: $goal"
    done

    # ä¿å­˜é¡¹ç›®è®¡åˆ’
    echo "${improvement_projects[@]}" > /opt/support/slm/improvement_projects.txt
}

# 4. å®æ–½è®¡åˆ’åˆ¶å®š
implementation_planning() {
    echo ""
    echo "4. Implementation Planning"

    projects_file="/opt/support/slm/improvement_projects.txt"

    if [ -f "$projects_file" ]; then
        echo "Creating implementation schedule..."

        # åˆ›å»ºç”˜ç‰¹å›¾æ•°æ®
        gantt_data="/opt/support/slm/implementation_schedule.csv"
        echo "Project,Start Date,End Date,Status,Progress" > $gantt_data

        current_date=$(date +%Y-%m-%d)

        while IFS=':' read -r project_id project_name priority duration goal; do
            # è®¡ç®—ç»“æŸæ—¥æœŸ
            end_date=$(date -d "+$duration days" +%Y-%m-%d)

            # æ·»åŠ åˆ°ç”˜ç‰¹å›¾
            echo "$project_name,$current_date,$end_date,Planned,0%" >> $gantt_data

            # åˆ›å»ºé¡¹ç›®æ–‡æ¡£
            project_dir="/opt/support/slm/projects/$project_id"
            mkdir -p "$project_dir"

            cat > "$project_dir/project_plan.md" << EOF
# $project_name

**Project ID**: $project_id
**Priority**: $priority
**Duration**: $duration days
**Start Date**: $current_date
**End Date**: $end_date

## Project Goal
$goal

## Objectives
1. [Define specific objectives]

## Tasks
1. [List implementation tasks]

## Resources Required
- [List required resources]

## Risk Assessment
- [Identify potential risks]

## Success Criteria
- [Define success metrics]
EOF

            # åˆ›å»ºä»»åŠ¡è·Ÿè¸ª
            cat > "$project_dir/tasks.txt" << EOF
Task,Status,Assigned To,Due Date,Priority
Task 1,Not Started,,,
Task 2,Not Started,,,
Task 3,Not Started,,,
EOF

        done < <(echo "${improvement_projects[@]}" | tr ' ' '\n')

        echo "Implementation plan created in: $gantt_data"
        echo "Project documents created in: /opt/support/slm/projects/"
    fi
}

# 5. é£é™©è¯„ä¼°å’Œç¼“è§£
risk_assessment() {
    echo ""
    echo "5. Risk Assessment and Mitigation"

    # è¯†åˆ«å®æ–½é£é™©
    risks=(
        "Resource_Constraints:High:Team availability and expertise"
        "Budget_Limits:Medium:Financial resources for improvements"
        "Schedule_Delays:Medium:Timeline constraints"
        "Technical_Complexity:High:Implementation complexity"
        "User_Disruption:Low:Impact on users during implementation"
    )

    echo "Risk Assessment:"
    for risk in "${risks[@]}"; do
        IFS=':' read -r risk_id severity description <<< "$risk"
        echo ""
        echo "Risk: $description"
        echo "  Severity: $severity"
        echo "  ID: $risk_id"

        # ç”Ÿæˆç¼“è§£ç­–ç•¥
        case $severity in
            "High")
                echo "  Mitigation: Implement monitoring and contingency plans"
                ;;
            "Medium")
                echo "  Mitigation: Regular progress reviews and resource allocation"
                ;;
            "Low")
                echo "  Mitigation: Standard project management practices"
                ;;
        esac
    done

    # åˆ›å»ºé£é™©ç™»è®°å†Œ
    risk_register="/opt/support/slm/risk_register.json"
    cat > $risk_register << 'EOF'
{
  "risks": [
    {
      "id": "R001",
      "description": "Team availability and expertise",
      "severity": "High",
      "probability": "Medium",
      "impact": "High",
      "mitigation": "Cross-training and knowledge sharing",
      "status": "Active"
    },
    {
      "id": "R002",
      "description": "Financial resources for improvements",
      "severity": "Medium",
      "probability": "Low",
      "impact": "Medium",
      "mitigation": "Budget planning and prioritization",
      "status": "Monitored"
    }
  ],
  "last_updated": "2024-01-01"
}
EOF

    echo ""
    echo "Risk register created: $risk_register"
}

# 6. æˆæœ¬æ•ˆç›Šåˆ†æ
cost_benefit_analysis() {
    echo ""
    echo "6. Cost-Benefit Analysis"

    # å®šä¹‰æˆæœ¬é¡¹ç›®
    costs=(
        "Personnel:5000:Staff time for implementation"
        "Hardware:10000:New hardware or upgrades"
        "Software:2000:Software licenses or tools"
        "Training:1500:Staff training costs"
        "Maintenance:1000:Ongoing maintenance"
    )

    # è®¡ç®—æ€»æˆæœ¬
    total_cost=0
    echo "Cost Analysis:"
    for cost in "${costs[@]}"; do
        IFS=':' read -r cost_type amount description <<< "$cost"
        echo "- $cost_type: \$${amount} - $description"
        total_cost=$((total_cost + amount))
    done

    echo ""
    echo "Total Implementation Cost: \$${total_cost}"

    # è®¡ç®—é¢„æœŸæ”¶ç›Š
    benefits=(
        "Improved_Efficiency:3000:Reduced support tickets"
        "Better_Performance:5000:Increased user productivity"
        "Reduced_Downtime:8000:Less service interruption"
        "Enhanced_Satisfaction:2000:Better user experience"
    )

    total_benefit=0
    echo ""
    echo "Benefit Analysis:"
    for benefit in "${benefits[@]}"; do
        IFS=':' read -r benefit_type amount description <<< "$benefit"
        echo "- $benefit_type: \$${amount} - $description"
        total_benefit=$((total_benefit + amount))
    done

    echo ""
    echo "Total Expected Benefit: \$${total_benefit}"

    # è®¡ç®—ROI
    roi=$(echo "scale=2; ($total_benefit - $total_cost) * 100 / $total_cost" | bc)
    echo ""
    echo "Return on Investment (ROI): ${roi}%"

    # åˆ›å»ºæˆæœ¬æ•ˆç›ŠæŠ¥å‘Š
    cost_benefit_report="/opt/support/slm/cost_benefit_analysis.html"
    cat > $cost_benefit_report << EOF
<!DOCTYPE html>
<html>
<head>
    <title>Cost-Benefit Analysis Report</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .summary { background-color: #f0f0f0; padding: 15px; border-radius: 5px; }
        .positive { color: green; font-weight: bold; }
        .negative { color: red; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Cost-Benefit Analysis Report</h1>
    <div class="summary">
        <p><strong>Total Cost:</strong> \$${total_cost}</p>
        <p><strong>Total Benefit:</strong> \$${total_benefit}</p>
        <p><strong>ROI:</strong> <span class="$(if [ $(echo "$roi > 0" | bc) -eq 1 ]; then echo 'positive'; else echo 'negative'; fi)">${roi}%</span></p>
    </div>
</body>
</html>
EOF

    echo ""
    echo "Cost-benefit analysis report: $cost_benefit_report"
}

# 7. å®æ–½ç›‘æ§å’Œè¯„ä¼°
implementation_monitoring() {
    echo ""
    echo "7. Implementation Monitoring and Evaluation"

    # åˆ›å»ºç›‘æ§ä»ªè¡¨æ¿
    dashboard_file="/opt/support/slm/implementation_dashboard.html"

    cat > $dashboard_file << 'EOF'
<!DOCTYPE html>
<html>
<head>
    <title>Implementation Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .dashboard { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
        .card { border: 1px solid #ddd; padding: 15px; border-radius: 5px; }
        .metric { font-size: 24px; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Service Improvement Implementation Dashboard</h1>

    <div class="dashboard">
        <div class="card">
            <h3>Project Status</h3>
            <canvas id="projectChart"></canvas>
        </div>

        <div class="card">
            <h3>Resource Allocation</h3>
            <canvas id="resourceChart"></canvas>
        </div>

        <div class="card">
            <h3>Risk Status</h3>
            <div class="metric" id="riskCount">0</div>
            <p>Active risks</p>
        </div>

        <div class="card">
            <h3>Progress Tracking</h3>
            <div class="metric" id="progressPercent">0%</div>
            <p>Overall completion</p>
        </div>
    </div>

    <script>
        // é¡¹ç›®çŠ¶æ€å›¾è¡¨
        const ctx1 = document.getElementById('projectChart').getContext('2d');
        new Chart(ctx1, {
            type: 'doughnut',
            data: {
                labels: ['Completed', 'In Progress', 'Not Started'],
                datasets: [{
                    data: [30, 40, 30],
                    backgroundColor: ['#28a745', '#ffc107', '#dc3545']
                }]
            }
        });

        // èµ„æºåˆ†é…å›¾è¡¨
        const ctx2 = document.getElementById('resourceChart').getContext('2d');
        new Chart(ctx2, {
            type: 'bar',
            data: {
                labels: ['Personnel', 'Hardware', 'Software', 'Training'],
                datasets: [{
                    label: 'Allocated Budget',
                    data: [5000, 10000, 2000, 1500],
                    backgroundColor: '#007bff'
                }]
            }
        });
    </script>
</body>
</html>
EOF

    echo "Implementation dashboard created: $dashboard_file"
    echo "Dashboard provides real-time monitoring of improvement projects"
}

# 8. ä¸»æµç¨‹
main_improvement_planning() {
    echo "Starting Service Improvement Planning Process..."

    # æ‰§è¡Œå„ä¸ªæ­¥éª¤
    root_cause_analysis
    opportunity_identification
    improvement_project_planning
    implementation_planning
    risk_assessment
    cost_benefit_analysis
    implementation_monitoring

    echo ""
    echo "=== Service Improvement Planning Complete ==="
    echo "Review the generated documents and reports:"
    echo "- /opt/support/slm/improvement_projects.txt"
    echo "- /opt/support/slm/projects/"
    echo "- /opt/support/slm/cost_benefit_analysis.html"
    echo "- /opt/support/slm/implementation_dashboard.html"
}

# è¿è¡Œä¸»æµç¨‹
main_improvement_planning
```

## ğŸ“š ç”¨æˆ·æœåŠ¡æœ€ä½³å®è·µ

## ğŸ“ æœ¬ç« æ€»ç»“

ç”¨æˆ·æœåŠ¡ä¸æ”¯æŒæ˜¯HPCè¿ç»´çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œé€šè¿‡æœ¬ç« å­¦ä¹ ï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š

- âœ… è®¾è®¡å’Œå®æ–½åˆ†å±‚ç”¨æˆ·åŸ¹è®­ä½“ç³»
- âœ… å»ºç«‹æ ‡å‡†åŒ–çš„æŠ€æœ¯æ”¯æŒæµç¨‹
- âœ… é…ç½®è‡ªåŠ¨åŒ–å·¥å•ç®¡ç†ç³»ç»Ÿ
- âœ… å®æ–½æœ‰æ•ˆçš„SLAç®¡ç†æœºåˆ¶
- âœ… æä¾›é«˜è´¨é‡çš„ç”¨æˆ·æœåŠ¡

ä¼˜ç§€çš„ç”¨æˆ·æœåŠ¡ä¸ä»…èƒ½å¤Ÿæå‡ç”¨æˆ·æ»¡æ„åº¦ï¼Œè¿˜èƒ½æé«˜é›†ç¾¤çš„ä½¿ç”¨æ•ˆç‡å’Œèµ„æºåˆ©ç”¨ç‡ã€‚

## ğŸ“ ç»ƒä¹ é¢˜

1. **å®è·µé¢˜**ï¼šä¸ºä½ çš„é›†ç¾¤è®¾è®¡å®Œæ•´çš„ç”¨æˆ·åŸ¹è®­ä½“ç³»
2. **é…ç½®é¢˜**ï¼šé…ç½®å·¥å•åˆ†ç±»å’Œåˆ†é…è‡ªåŠ¨åŒ–ç³»ç»Ÿ
3. **ç®¡ç†é¢˜**ï¼šåˆ¶å®šé€‚åˆä½ é›†ç¾¤çš„SLAæ ‡å‡†
4. **ä¼˜åŒ–é¢˜**ï¼šåˆ†æç°æœ‰ç”¨æˆ·æœåŠ¡æµç¨‹å¹¶æå‡ºæ”¹è¿›å»ºè®®

## ğŸ”— å‚è€ƒèµ„æº

- [ITIL Service Management](https://www.axelos.com/best-practice/itil)
- [HPC User Support Best Practices](https://www.hpcadvisorycouncil.com/pdf/HPC_User_Support_Best_Practices.pdf)
- [Service Level Management](https://www.bmc.com/it-solutions/service-level-management.html)
- [Technical Support Metrics](https://www.helpscout.com/support-metrics/)